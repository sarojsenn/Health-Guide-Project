<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediMate - Your Personal Health Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            light: '#4F46E5',
                            dark: '#6366F1'
                        },
                        secondary: {
                            light: '#059669',
                            dark: '#10B981'
                        },
                        background: {
                            light: '#F3F4F6',
                            dark: '#111827'
                        },
                        card: {
                            light: '#FFFFFF',
                            dark: '#1F2937'
                        },
                        text: {
                            light: '#374151',
                            dark: '#F9FAFB'
                        },
                        muted: {
                            light: '#6B7280',
                            dark: '#9CA3AF'
                        }
                    },
                    boxShadow: {
                        'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .health-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }
        
        .health-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .chat-bubble {
            border-radius: 20px;
            border-bottom-left-radius: 2px;
        }
        
        .user-bubble {
            border-radius: 20px;
            border-bottom-right-radius: 2px;
        }
        
        .theme-toggle {
            transition: all 0.3s ease;
        }
        
        /* Gradient backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-primary {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
        }
        
        .gradient-secondary {
            background: linear-gradient(135deg, #059669 0%, #0891B2 100%);
        }
        
        /* Glass morphism effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass-card {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Animated progress bars */
        .animated-progress {
            background: linear-gradient(90deg, #4F46E5, #7C3AED, #EC4899);
            background-size: 200% 200%;
            animation: gradient-flow 3s ease infinite;
        }
        
        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Floating animation */
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }
        
        /* Pulse animation for buttons */
        .pulse-btn {
            animation: pulse-scale 2s infinite;
        }
        
        @keyframes pulse-scale {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Custom scrollbar with gradient */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #4F46E5, #7C3AED);
            border-radius: 4px;
        }
        
        .dark ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #6366F1, #8B5CF6);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #3730A3, #6B21A8);
        }
        
        /* Shimmer effect */
        .shimmer {
            background: linear-gradient(90deg, 
                transparent 25%, 
                rgba(255,255,255,0.5) 50%, 
                transparent 75%
            );
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        /* Glow effects */
        .glow-primary {
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.3);
        }
        
        .glow-secondary {
            box-shadow: 0 0 20px rgba(5, 150, 105, 0.3);
        }
        
        /* Animated icons */
        .icon-bounce:hover {
            animation: bounce 0.5s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }

        /* Tour pulse animation */
        @keyframes pulse {
            0% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.7);
            }
            70% {
                transform: scale(1.02);
                box-shadow: 0 0 0 10px rgba(79, 70, 229, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(79, 70, 229, 0);
            }
        }

        /* Goal Progress Bars */
        .goal-progress-bar {
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Modal animations */
        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Progress indicator */
        .progress-indicator {
            transition: left 0.5s ease-in-out;
        }

        /* Hover effects for goal cards */
        .goal-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        /* Success/Error message animations */
        .message-enter {
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="bg-background-light text-text-light dark:bg-background-dark dark:text-text-dark min-h-screen">
    <nav class="bg-card-light/80 dark:bg-card-dark/80 backdrop-blur-lg shadow-soft py-3 px-6 flex justify-between items-center fixed top-0 left-0 right-0 z-50 border-b border-gray-200/20 dark:border-gray-700/20">
        <div class="flex items-center flex-1">
            <div class="flex items-center">
                <div class="relative">
                    <i class="fas fa-heartbeat text-primary-light dark:text-primary-dark text-2xl mr-3 icon-bounce"></i>
                    <div class="absolute -top-1 -right-1 w-3 h-3 bg-gradient-primary rounded-full animate-pulse"></div>
                </div>
                <h1 class="text-xl font-bold bg-gradient-to-r from-primary-light to-purple-600 bg-clip-text text-transparent">MediMate</h1>
            </div>
            
        </div>
        
        <div class="flex items-center space-x-6">
            <div class="hidden md:flex space-x-6">
                <a href="#profile" class="relative text-muted-light dark:text-muted-dark hover:text-primary-light dark:hover:text-primary-dark transition-colors group">
                    Home
                    <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-primary transition-all duration-300 group-hover:w-full"></span>
                </a>
                <a href="#nutriscan" class="relative text-muted-light dark:text-muted-dark hover:text-primary-light dark:hover:text-primary-dark transition-colors group">
                    Medical Support
                    <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-primary transition-all duration-300 group-hover:w-full"></span>
                </a>
                <a href="../Water And Sanitation/frontend/index.html" target="_blank" rel="noopener noreferrer" class="relative text-muted-light dark:text-muted-dark hover:text-primary-light dark:hover:text-primary-dark transition-colors group">
                    Water & Sanitation Support
                    <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-primary transition-all duration-300 group-hover:w-full"></span>
                </a>
            </div>
            
            <button id="themeToggle" class="theme-toggle p-3 rounded-full bg-background-light/50 dark:bg-background-dark/50 backdrop-blur-sm hover:bg-gray-200/50 dark:hover:bg-gray-700/50 transition-all duration-300 hover:scale-105">
                <i class="fas fa-moon text-muted-light dark:text-yellow-300 transition-transform duration-300"></i>
            </button>
            
            <!-- User Profile Section (shown when logged in) -->
            <div id="userProfileSection" class="hidden flex items-center space-x-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-white text-sm"></i>
                    </div>
                    <div class="hidden md:block">
                        <p class="text-sm font-medium" id="userDisplayName">Welcome!</p>
                        <p class="text-xs text-muted-light dark:text-muted-dark" id="userEmail">user@example.com</p>
                    </div>
                </div>
                
                <!-- Logout Button -->
                <button id="logoutBtn" class="relative overflow-hidden bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-full font-medium transition-all duration-300 transform hover:scale-105 hover:shadow-lg group">
                    <span class="relative z-10 flex items-center">
                        <i class="fas fa-sign-out-alt mr-2"></i>
                        Logout
                    </span>
                    <div class="absolute inset-0 bg-white/20 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left"></div>
                </button>
            </div>
            
            <!-- Login Button (shown when not logged in) -->
            <button id="loginBtn" class="relative overflow-hidden gradient-primary text-white px-6 py-3 rounded-full font-medium transition-all duration-300 transform hover:scale-105 hover:shadow-lg glow-primary group" 
                    onclick="window.location.href='auth.html'">
                <span class="relative z-10">Login / Sign Up</span>
                <div class="absolute inset-0 bg-white/20 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left"></div>
            </button>
        </div>
    </nav>
    
    <div class="h-16"></div>

    <section class="py-20 px-6 relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-br from-primary-light/5 to-purple-600/5"></div>
        <div class="absolute top-20 left-20 w-32 h-32 bg-primary-light/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-20 right-20 w-40 h-40 bg-purple-600/10 rounded-full blur-3xl"></div>
        
        <div class="max-w-6xl mx-auto relative z-10">
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div>
                    <div class="inline-block px-4 py-2 bg-primary-light/10 dark:bg-primary-dark/10 rounded-full text-primary-light dark:text-primary-dark text-sm font-medium mb-6 backdrop-blur-sm">
                        ðŸš€ New AI-Powered Features Available
                    </div>
                    
                    <h2 class="text-5xl md:text-6xl font-bold mb-6 leading-tight">
                        Your Personal 
                        <span class="bg-gradient-to-r from-primary-light via-purple-600 to-pink-500 bg-clip-text text-transparent animate-pulse">
                            Health & Nutrition
                        </span> 
                        Assistant
                    </h2>
                    <p class="text-xl text-muted-light dark:text-muted-dark mb-10 leading-relaxed">
                        Transform your wellness journey with AI-powered insights, personalized meal plans, and real-time health monitoring tailored just for you.
                    </p>
                    
                    <div class="flex flex-col sm:flex-row gap-4 mb-12">
                        <button id="getStartedBtn" class="relative overflow-hidden gradient-primary text-white px-8 py-4 rounded-full font-medium transition-all duration-300 transform hover:scale-105 shadow-soft hover:shadow-lg glow-primary group">
                            <span class="relative z-10 flex items-center">
                                <i class="fas fa-rocket mr-2"></i>
                                Get Started 
                            </span>
                            <div class="absolute inset-0 bg-white/20 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left"></div>
                        </button>
                        <button id="watchDemoBtn" class="glass-card text-primary-light dark:text-primary-dark px-8 py-4 rounded-full font-medium hover:bg-gray-100/20 dark:hover:bg-gray-800/20 transition-all duration-300 group">
                            <i class="fas fa-play mr-2 group-hover:scale-110 transition-transform"></i>
                            Watch Demo
                        </button>
                    </div>
                    
                    <div class="flex items-center space-x-6">
                        <div class="flex -space-x-3">
                            <div class="w-12 h-12 rounded-full border-2 border-white dark:border-gray-800 bg-gradient-to-r from-blue-400 to-blue-600 shadow-lg"></div>
                            <div class="w-12 h-12 rounded-full border-2 border-white dark:border-gray-800 bg-gradient-to-r from-green-400 to-green-600 shadow-lg"></div>
                            <div class="w-12 h-12 rounded-full border-2 border-white dark:border-gray-800 bg-gradient-to-r from-purple-400 to-purple-600 shadow-lg"></div>
                            <div class="w-12 h-12 rounded-full border-2 border-white dark:border-gray-800 bg-gradient-to-r from-pink-400 to-pink-600 shadow-lg flex items-center justify-center text-white font-bold text-sm">
                                +10K
                            </div>
                        </div>
                        <div>
                            <p class="text-sm text-muted-light dark:text-muted-dark">
                                <span class="font-semibold text-lg">12,000+</span> health enthusiasts trust us
                            </p>
                            <div class="flex items-center mt-1">
                                <div class="flex text-yellow-400">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="ml-2 text-sm text-muted-light dark:text-muted-dark">4.9/5 rating</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="relative float-animation">
                    <div class="absolute inset-0 bg-gradient-to-r from-primary-light/20 to-purple-600/20 rounded-3xl transform rotate-6 blur-sm"></div>
                    <div class="absolute inset-0 bg-gradient-to-l from-pink-500/20 to-orange-500/20 rounded-3xl transform -rotate-3 blur-sm"></div>
                    <div class="relative glass-card rounded-3xl p-6 shadow-soft overflow-hidden">
                        <img id="healthTrackingImage" 
                             src="https://images.unsplash.com/photo-1576091160550-2173dba999ef?auto=format&fit=crop&w=800" 
                             alt="Health Dashboard" 
                             class="rounded-2xl object-cover w-full h-[500px] transition-opacity duration-1000">
                        <div class="absolute top-8 left-8 glass-card rounded-xl p-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-sm font-medium">Live Health Tracking</span>
                            </div>
                        </div>
                        <div class="absolute bottom-8 right-8 glass-card rounded-xl p-4">
                            <div id="healthScore" class="text-2xl font-bold gradient-primary bg-clip-text text-transparent">98%</div>
                            <div class="text-xs text-muted-light dark:text-muted-dark">Health Score</div>
                        </div>
                        <div class="absolute top-8 right-8 glass-card rounded-xl p-2">
                            <button id="refreshHealthBtn" class="text-primary-light dark:text-primary-dark hover:text-purple-600 transition-colors">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    
    <main class="container mx-auto px-4 pb-20">
        
        <section id="profile" class="mb-16">
            <div class="max-w-6xl mx-auto">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-4xl font-bold bg-gradient-to-r from-primary-light to-purple-600 bg-clip-text text-transparent">Your Health Journey</h2>
                        <p class="text-muted-light dark:text-muted-dark mt-2">Track your progress and unlock new achievements</p>
                    </div>
                    <button id="addGoalBtn" class="glass-card text-primary-light dark:text-primary-dark px-6 py-3 rounded-full font-medium hover:bg-primary-light/10 dark:hover:bg-primary-dark/10 transition-all duration-300 transform hover:scale-105 glow-primary group">
                        <i class="fas fa-plus mr-2 group-hover:rotate-180 transition-transform duration-300"></i> 
                        Add Goal
                    </button>
                </div>
                
                <div class="grid md:grid-cols-12 gap-8">
                    <div class="md:col-span-8">
                        <div class="health-card bg-card-light dark:bg-card-dark p-8 rounded-3xl shadow-soft mb-8 relative overflow-hidden">
                            
                            <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-primary opacity-10 rounded-full blur-3xl"></div>
                            
                            <div class="flex items-start space-x-6 relative z-10">
                                <div class="relative">
                                    <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-primary-light to-purple-600 p-0.5">
                                        <div class="w-full h-full rounded-2xl bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                                            <i class="fas fa-user text-2xl text-primary-light"></i>
                                        </div>
                                    </div>
                                    <div class="absolute -bottom-2 -right-2 w-6 h-6 bg-green-400 rounded-full border-2 border-white dark:border-gray-800 pulse-btn"></div>
                                </div>
                                <div class="flex-1">
                                    <div class="flex flex-col gap-4 mb-6">
                                        <div>
                                            <h3 class="text-2xl font-bold" id="profileName">User Name</h3>
                                            <p class="text-muted-light dark:text-muted-dark" id="profileId">Patient ID: #</p>
                                        </div>
                                        <div>
                                            <button id="generatePdfBtn" class="gradient-primary text-white px-6 py-3 rounded-full font-medium transition-all duration-300 transform hover:scale-105 hover:shadow-lg glow-primary group">
                                                <i class="fas fa-file-pdf mr-2"></i>Download Medical History PDF
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="health-card bg-card-light dark:bg-card-dark p-8 rounded-3xl shadow-soft relative overflow-hidden">
                            
                            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-primary"></div>
                            
                            <div class="flex items-center justify-between mb-8">
                                <div>
                                    <h3 class="text-2xl font-bold">Health Goals</h3>
                                    <p class="text-muted-light dark:text-muted-dark">Track your daily wellness targets</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="glass-card p-3 rounded-xl hover:bg-primary-light/10 transition-all duration-300">
                                        <i class="fas fa-chart-line text-primary-light"></i>
                                    </button>
                                    <button class="glass-card p-3 rounded-xl hover:bg-primary-light/10 transition-all duration-300">
                                        <i class="fas fa-ellipsis-h text-muted-light dark:text-muted-dark"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div id="goalsContainer" class="space-y-6">
                                <div class="glass-card p-6 rounded-2xl hover:bg-primary-light/5 transition-all duration-300 group">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center space-x-4">
                                            <div class="relative">
                                                <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                                                    <i class="fas fa-tint text-white text-lg"></i>
                                                </div>
                                                <div class="absolute -top-1 -right-1 w-5 h-5 bg-green-400 rounded-full flex items-center justify-center">
                                                    <i class="fas fa-check text-white text-xs"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-lg">Daily Water Intake</h4>
                                                <p class="text-sm text-muted-light dark:text-muted-dark">Goal: 3L â€¢ Current: 2.2L</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <button class="gradient-primary text-white px-4 py-2 rounded-full text-sm font-medium hover:scale-105 transition-transform">
                                                <i class="fas fa-plus mr-1"></i> Add
                                            </button>
                                            <p class="text-xs text-muted-light dark:text-muted-dark mt-1">Due today</p>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <div class="w-full h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                            <div class="animated-progress h-full rounded-full" style="width: 73%"></div>
                                        </div>
                                        <div class="absolute -top-1 left-[73%] transform -translate-x-1/2">
                                            <div class="w-5 h-5 bg-white dark:bg-gray-800 rounded-full border-2 border-blue-500 shadow-lg"></div>
                                        </div>
                                    </div>
                                    <p class="text-right text-sm font-medium text-blue-600 dark:text-blue-400 mt-2">73% Complete</p>
                                </div>
                                
                                <div class="glass-card p-6 rounded-2xl hover:bg-secondary-light/5 transition-all duration-300 group">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center space-x-4">
                                            <div class="relative">
                                                <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
                                                    <i class="fas fa-running text-white text-lg"></i>
                                                </div>
                                                <div class="absolute -top-1 -right-1 w-5 h-5 bg-orange-400 rounded-full flex items-center justify-center">
                                                    <i class="fas fa-clock text-white text-xs"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-lg">Weekly Exercise Plan</h4>
                                                <p class="text-sm text-muted-light dark:text-muted-dark">Goal: 5 days â€¢ Current: 3 days</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <button class="gradient-secondary text-white px-4 py-2 rounded-full text-sm font-medium hover:scale-105 transition-transform">
                                                <i class="fas fa-play mr-1"></i> Start
                                            </button>
                                            <p class="text-xs text-muted-light dark:text-muted-dark mt-1">Due tomorrow</p>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <div class="w-full h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                            <div class="bg-gradient-secondary h-full rounded-full" style="width: 60%"></div>
                                        </div>
                                        <div class="absolute -top-1 left-[60%] transform -translate-x-1/2">
                                            <div class="w-5 h-5 bg-white dark:bg-gray-800 rounded-full border-2 border-green-500 shadow-lg"></div>
                                        </div>
                                    </div>
                                    <p class="text-right text-sm font-medium text-green-600 dark:text-green-400 mt-2">60% Complete</p>
                                </div>

                                <div class="glass-card p-6 rounded-2xl hover:bg-purple-500/5 transition-all duration-300 group">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                                                <i class="fas fa-chart-pie text-white text-lg"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-lg">Weekly BMI Analysis</h4>
                                                <p class="text-sm text-green-500">
                                                    <i class="fas fa-check-circle mr-1"></i>
                                                    Completed this week
                                                </p>
                                            </div>
                                        </div>
                                        <button class="glass-card text-purple-600 dark:text-purple-400 px-4 py-2 rounded-full text-sm font-medium hover:bg-purple-500/10 transition-all">
                                            <i class="fas fa-eye mr-1"></i> View Report
                                        </button>
                                    </div>
                                </div>

                                <div class="text-center pt-4">
                                    <button class="text-primary-light dark:text-primary-dark hover:underline text-sm font-medium flex items-center mx-auto group">
                                        View all goals 
                                        <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="md:col-span-4">
                        <div class="health-card bg-card-light dark:bg-card-dark p-6 rounded-2xl shadow-soft">
                            <h3 class="text-xl font-semibold mb-6">Upcoming Events</h3>
                            
                            <div class="space-y-4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 bg-primary-light/10 dark:bg-primary-dark/10 rounded-lg flex flex-col items-center justify-center">
                                        <span class="text-sm font-medium text-primary-light dark:text-primary-dark">AUG</span>
                                        <span class="text-lg font-bold text-primary-light dark:text-primary-dark">25</span>
                                    </div>
                                    <div>
                                        <h4 class="font-medium">Health Check-up</h4>
                                        <p class="text-sm text-muted-light dark:text-muted-dark">9:00 AM</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 bg-secondary-light/10 dark:bg-secondary-dark/10 rounded-lg flex flex-col items-center justify-center">
                                        <span class="text-sm font-medium text-secondary-light dark:text-secondary-dark">AUG</span>
                                        <span class="text-lg font-bold text-secondary-light dark:text-secondary-dark">27</span>
                                    </div>
                                    <div>
                                        <h4 class="font-medium">Nutrition Workshop</h4>
                                        <p class="text-sm text-muted-light dark:text-muted-dark">2:30 PM</p>
                                    </div>
                                </div>
                            </div>
                            
                            <button class="w-full mt-6 text-center text-primary-light dark:text-primary-dark hover:underline text-sm font-medium">
                                View All Events
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        
        <section id="nutriscan" class="mb-16">
            <div class="max-w-6xl mx-auto">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-3xl font-bold">HealthNutri Wellness Survey</h2>
                        <p class="text-muted-light dark:text-muted-dark mt-2">Track your nutrition and wellness journey</p>
                    </div>
                </div>

                <div class="grid md:grid-cols-12 gap-8">
                    <div class="md:col-span-8">
                        <div class="health-card bg-card-light dark:bg-card-dark p-6 rounded-2xl shadow-soft">
                            <div class="flex items-center justify-between mb-8">
                                <div>
                                    <h3 class="text-xl font-semibold mb-2">Personal Health Assessment</h3>
                                    <p class="text-muted-light dark:text-muted-dark">Complete your health evaluation</p>
                                </div>
                                <div class="flex space-x-3">
                                    <button id="chartViewToggle" class="px-4 py-2 bg-primary-light text-white rounded-lg text-sm hover:bg-primary-dark transition-all">
                                        <i class="fas fa-chart-pie mr-2"></i>Charts View
                                    </button>
                                    <button id="trendViewToggle" class="px-4 py-2 bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-600 rounded-lg text-sm hover:bg-gray-200 dark:hover:bg-gray-700 transition-all">
                                        <i class="fas fa-chart-line mr-2"></i>Trends
                                    </button>
                                </div>
                            </div>

                            <!-- Charts Container -->
                            <div id="chartsContainer" class="mb-8">
                                <div class="grid md:grid-cols-2 gap-6 mb-6">
                                    <!-- Radial Chart for Overall Health -->
                                    <div class="bg-background-light dark:bg-background-dark rounded-xl p-6">
                                        <h4 class="font-semibold mb-4 text-center">Health Score Overview</h4>
                                        <div class="relative flex items-center justify-center">
                                            <svg width="160" height="160" class="transform -rotate-90">
                                                <circle cx="80" cy="80" r="70" stroke="currentColor" stroke-width="8" fill="none" class="text-gray-200 dark:text-gray-700"></circle>
                                                <circle id="healthScoreCircle" cx="80" cy="80" r="70" stroke="url(#healthGradient)" stroke-width="8" fill="none" 
                                                        stroke-linecap="round" stroke-dasharray="440" stroke-dashoffset="48.4" 
                                                        class="transition-all duration-1000 ease-out">
                                                </circle>
                                                <defs>
                                                    <linearGradient id="healthGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                                        <stop offset="0%" style="stop-color:#4F46E5;stop-opacity:1" />
                                                        <stop offset="100%" style="stop-color:#7C3AED;stop-opacity:1" />
                                                    </linearGradient>
                                                </defs>
                                            </svg>
                                            <div class="absolute inset-0 flex items-center justify-center flex-col">
                                                <span id="chartHealthScore" class="text-3xl font-bold text-primary-light dark:text-primary-dark">8.9</span>
                                                <span class="text-sm text-muted-light dark:text-muted-dark">out of 10</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Bar Chart for Categories -->
                                    <div class="bg-background-light dark:bg-background-dark rounded-xl p-6">
                                        <h4 class="font-semibold mb-4">Health Categories</h4>
                                        <div class="space-y-4">
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm font-medium">Nutrition</span>
                                                <div class="flex items-center space-x-2">
                                                    <div class="w-24 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                                        <div id="chartNutritionBar" class="h-full bg-green-500 rounded-full transition-all duration-1000" style="width: 85%"></div>
                                                    </div>
                                                    <span id="chartNutritionScore" class="text-sm font-medium text-green-600">8.5</span>
                                                </div>
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm font-medium">Activity</span>
                                                <div class="flex items-center space-x-2">
                                                    <div class="w-24 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                                        <div id="chartActivityBar" class="h-full bg-blue-500 rounded-full transition-all duration-1000" style="width: 78%"></div>
                                                    </div>
                                                    <span id="chartActivityScore" class="text-sm font-medium text-blue-600">7.8</span>
                                                </div>
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm font-medium">Sleep</span>
                                                <div class="flex items-center space-x-2">
                                                    <div class="w-24 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                                        <div id="chartSleepBar" class="h-full bg-purple-500 rounded-full transition-all duration-1000" style="width: 82%"></div>
                                                    </div>
                                                    <span id="chartSleepScore" class="text-sm font-medium text-purple-600">8.2</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Trend Chart -->
                                <div id="trendChart" class="bg-background-light dark:bg-background-dark rounded-xl p-6 hidden">
                                    <h4 class="font-semibold mb-4">7-Day Health Trend</h4>
                                    <div class="relative h-48">
                                        <svg id="trendSvg" width="100%" height="100%" class="overflow-visible">
                                            <!-- Grid lines will be added here -->
                                            <defs>
                                                <linearGradient id="trendGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                                    <stop offset="0%" style="stop-color:#4F46E5;stop-opacity:0.3" />
                                                    <stop offset="100%" style="stop-color:#4F46E5;stop-opacity:0" />
                                                </linearGradient>
                                            </defs>
                                        </svg>
                                        <div class="absolute bottom-0 left-0 right-0 flex justify-between text-xs text-muted-light dark:text-muted-dark px-4">
                                            <span>7 days ago</span>
                                            <span>5 days ago</span>
                                            <span>3 days ago</span>
                                            <span>Yesterday</span>
                                            <span>Today</span>
                                        </div>
                                    </div>
                                    <div class="mt-4 flex justify-center space-x-6">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                            <span class="text-sm">Overall Health</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-sm">Nutrition</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-purple-500 rounded-full"></div>
                                            <span class="text-sm">Activity</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-8">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="font-semibold">Overall Health Score</h4>
                                    <span id="overallHealthScore" class="text-2xl font-bold text-primary-light dark:text-primary-dark">8.9/10</span>
                                </div>
                                <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full">
                                    <div id="overallHealthBar" class="h-full bg-primary-light dark:bg-primary-dark rounded-full transition-all duration-500" style="width: 89%"></div>
                                </div>
                            </div>

                            <div class="grid grid-cols-3 gap-6">
                                <div class="p-4 bg-background-light dark:bg-background-dark rounded-xl hover:shadow-lg transition-all duration-300">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-medium">Nutritional Balance</span>
                                        <span id="nutritionScore" class="text-sm text-primary-light dark:text-primary-dark">8.5</span>
                                    </div>
                                    <p id="nutritionStatus" class="text-sm text-muted-light dark:text-muted-dark">Good balance of nutrients</p>
                                    <div class="w-full h-1 bg-gray-200 dark:bg-gray-700 rounded-full mt-2">
                                        <div id="nutritionBar" class="h-full bg-green-500 rounded-full transition-all duration-500" style="width: 85%"></div>
                                    </div>
                                </div>
                                <div class="p-4 bg-background-light dark:bg-background-dark rounded-xl hover:shadow-lg transition-all duration-300">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-medium">Physical Activity</span>
                                        <span id="activityScore" class="text-sm text-primary-light dark:text-primary-dark">7.8</span>
                                    </div>
                                    <p id="activityStatus" class="text-sm text-muted-light dark:text-muted-dark">Regular exercise routine</p>
                                    <div class="w-full h-1 bg-gray-200 dark:bg-gray-700 rounded-full mt-2">
                                        <div id="activityBar" class="h-full bg-blue-500 rounded-full transition-all duration-500" style="width: 78%"></div>
                                    </div>
                                </div>
                                <div class="p-4 bg-background-light dark:bg-background-dark rounded-xl hover:shadow-lg transition-all duration-300">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-medium">Sleep Quality</span>
                                        <span id="sleepScore" class="text-sm text-primary-light dark:text-primary-dark">8.2</span>
                                    </div>
                                    <p id="sleepStatus" class="text-sm text-muted-light dark:text-muted-dark">Consistent sleep schedule</p>
                                    <div class="w-full h-1 bg-gray-200 dark:bg-gray-700 rounded-full mt-2">
                                        <div id="sleepBar" class="h-full bg-purple-500 rounded-full transition-all duration-500" style="width: 82%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="md:col-span-4">
                        <div class="health-card bg-card-light dark:bg-card-dark p-6 rounded-2xl shadow-soft mb-6">
                            <h3 class="text-xl font-semibold mb-6">Quick Health Survey</h3>
                            
                            <form id="healthSurveyForm" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">How would you rate your current health?</label>
                                    <div class="relative">
                                        <input type="range" id="healthRating" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700" min="0" max="10" value="8" step="0.1">
                                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                                            <span>Poor</span>
                                            <span id="healthRatingValue" class="font-medium text-primary-light dark:text-primary-dark">8.0</span>
                                            <span>Excellent</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">How many hours do you sleep per night?</label>
                                    <select id="sleepHours" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-background-light dark:bg-background-dark">
                                        <option value="4">Less than 5 hours</option>
                                        <option value="6">5-6 hours</option>
                                        <option value="7" selected>7-8 hours</option>
                                        <option value="9">8-9 hours</option>
                                        <option value="10">More than 9 hours</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">How many days per week do you exercise?</label>
                                    <div class="grid grid-cols-4 gap-2">
                                        <button type="button" class="exercise-btn px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-primary-light hover:text-white transition-all" data-value="0">0</button>
                                        <button type="button" class="exercise-btn px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-primary-light hover:text-white transition-all" data-value="1-2">1-2</button>
                                        <button type="button" class="exercise-btn px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-primary-light hover:text-white transition-all active" data-value="3-4">3-4</button>
                                        <button type="button" class="exercise-btn px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-primary-light hover:text-white transition-all" data-value="5+">5+</button>
                                    </div>
                                    <input type="hidden" id="exerciseFrequency" value="3-4">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Are you comfortable discussing health concerns?</label>
                                    <div class="flex space-x-4">
                                        <button type="button" id="agreeBtn" class="comfort-btn flex-1 py-2 bg-primary-light text-white rounded-lg text-sm transition-all hover:bg-primary-dark">Agree</button>
                                        <button type="button" id="disagreeBtn" class="comfort-btn flex-1 py-2 bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-600 rounded-lg text-sm transition-all hover:bg-gray-200 dark:hover:bg-gray-700">Disagree</button>
                                    </div>
                                    <input type="hidden" id="comfortLevel" value="agree">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">What is your primary health goal?</label>
                                    <select id="healthGoal" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-background-light dark:bg-background-dark">
                                        <option value="weight-loss">Weight Loss</option>
                                        <option value="muscle-gain">Muscle Gain</option>
                                        <option value="general-fitness" selected>General Fitness</option>
                                        <option value="stress-reduction">Stress Reduction</option>
                                        <option value="better-sleep">Better Sleep</option>
                                        <option value="nutrition-improvement">Nutrition Improvement</option>
                                    </select>
                                </div>
                                
                                <button type="submit" class="w-full bg-primary-light dark:bg-primary-dark text-white py-3 rounded-lg text-sm font-medium hover:bg-primary-dark dark:hover:bg-primary-light transition-all hover:scale-105 hover:shadow-lg">
                                    <i class="fas fa-chart-line mr-2"></i>Submit Survey & Update Scores
                                </button>
                            </form>
                            
                            <div id="surveyResult" class="mt-4 p-4 rounded-lg hidden">
                                <h4 class="font-medium text-green-600 dark:text-green-400 mb-2">
                                    <i class="fas fa-check-circle mr-2"></i>Survey Completed!
                                </h4>
                                <p class="text-sm text-muted-light dark:text-muted-dark">Your health scores have been updated based on your responses.</p>
                            </div>
                        </div>

                        <div class="health-card bg-card-light dark:bg-card-dark p-6 rounded-2xl shadow-soft">
                            <h3 class="text-xl font-semibold mb-6">Health Feedback & Reports</h3>
                            
                            <div class="space-y-4">
                                <div class="flex items-center space-x-3 p-3 bg-background-light dark:bg-background-dark rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-all cursor-pointer" onclick="generateDailyReport()">
                                    <div class="w-8 h-8 rounded-full bg-green-400 flex items-center justify-center">
                                        <i class="fas fa-chart-line text-white text-sm"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-sm">Daily Health Feedback</h4>
                                        <p class="text-xs text-muted-light dark:text-muted-dark">Track your daily wellness progress</p>
                                    </div>
                                    <button class="text-primary-light dark:text-primary-dark text-sm hover:underline">View</button>
                                </div>
                                
                                <div class="flex items-center space-x-3 p-3 bg-background-light dark:bg-background-dark rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-all cursor-pointer" onclick="generateWeeklyReport()">
                                    <div class="w-8 h-8 rounded-full bg-blue-400 flex items-center justify-center">
                                        <i class="fas fa-file-pdf text-white text-sm"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-sm">Weekly Health Summary</h4>
                                        <p class="text-xs text-muted-light dark:text-muted-dark">Get your comprehensive weekly report</p>
                                    </div>
                                    <button class="text-primary-light dark:text-primary-dark text-sm hover:underline">Download</button>
                                </div>
                                
                                <div class="flex items-center space-x-3 p-3 bg-background-light dark:bg-background-dark rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-all cursor-pointer" onclick="shareHealthData()">
                                    <div class="w-8 h-8 rounded-full bg-purple-400 flex items-center justify-center">
                                        <i class="fas fa-share-alt text-white text-sm"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-sm">Share Health Data</h4>
                                        <p class="text-xs text-muted-light dark:text-muted-dark">Share with healthcare provider</p>
                                    </div>
                                    <button class="text-primary-light dark:text-primary-dark text-sm hover:underline">Share</button>
                                </div>
                                
                                <div id="healthInsight" class="p-4 bg-gradient-to-r from-primary-light/10 to-purple-600/10 rounded-lg border-l-4 border-primary-light hidden">
                                    <h4 class="font-medium text-primary-light dark:text-primary-dark mb-2">
                                        <i class="fas fa-lightbulb mr-2"></i>Health Insight
                                    </h4>
                                    <p id="insightText" class="text-sm text-muted-light dark:text-muted-dark"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        
        <section id="recommendations" class="mb-16">
            <div class="max-w-6xl mx-auto">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-3xl font-bold">Personalized Meal Plans</h2>
                        <p class="text-muted-light dark:text-muted-dark mt-2">AI-powered nutrition recommendations based on your health data</p>
                    </div>
                    <button id="generateMealPlanBtn" class="gradient-primary text-white px-6 py-3 rounded-full font-medium transition-all duration-300 transform hover:scale-105 hover:shadow-lg glow-primary">
                        <i class="fas fa-magic mr-2"></i>Generate New Plan
                    </button>
                </div>

                <div class="grid md:grid-cols-12 gap-8">
                    <div class="md:col-span-8">
                        <!-- Lab Report Upload Section -->
                        <div class="health-card bg-card-light dark:bg-card-dark p-6 rounded-2xl shadow-soft mb-6">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="text-xl font-semibold mb-2">Upload Lab Reports</h3>
                                    <p class="text-muted-light dark:text-muted-dark">Upload your latest health reports for AI-powered personalized recommendations</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span id="labReportStatus" class="text-sm px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300">
                                        <i class="fas fa-clock mr-1"></i>No reports uploaded
                                    </span>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-8 text-center hover:border-primary-light dark:hover:border-primary-dark transition-all duration-300" id="labReportDropZone">
                                    <div class="mb-4">
                                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 dark:text-gray-500 mb-3"></i>
                                        <p class="text-lg font-medium mb-2">Drop your lab reports here</p>
                                        <p class="text-sm text-muted-light dark:text-muted-dark">or click to browse files</p>
                                    </div>
                                    <input type="file" id="labReportInput" class="hidden" accept=".pdf,.jpg,.jpeg,.png,.txt" multiple>
                                    <button type="button" onclick="document.getElementById('labReportInput').click()" class="gradient-primary text-white px-6 py-2 rounded-lg font-medium hover:scale-105 transition-transform">
                                        <i class="fas fa-file-upload mr-2"></i>Select Files
                                    </button>
                                    <p class="text-xs text-gray-500 mt-3">Supported formats: PDF, JPG, PNG, TXT (Max 10MB per file)</p>
                                </div>

                                <div id="uploadedFiles" class="space-y-2 hidden">
                                    <h4 class="font-medium text-primary-light dark:text-primary-dark">Uploaded Reports:</h4>
                                    <div id="filesList" class="space-y-2"></div>
                                </div>

                                <div class="flex space-x-4">
                                    <button id="analyzeReportsBtn" class="flex-1 bg-primary-light dark:bg-primary-dark text-white py-3 rounded-lg font-medium hover:bg-primary-dark dark:hover:bg-primary-light transition-all disabled:opacity-50" disabled>
                                        <i class="fas fa-brain mr-2"></i>Analyze with AI
                                    </button>
                                    <button id="clearReportsBtn" class="px-6 py-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all" disabled>
                                        <i class="fas fa-trash mr-2"></i>Clear
                                    </button>
                                </div>
                            </div>

                            <div id="analysisProgress" class="mt-6 hidden">
                                <div class="flex items-center space-x-3 mb-3">
                                    <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-primary-light"></div>
                                    <span class="text-sm font-medium">Analyzing your lab reports with AI...</span>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                    <div id="analysisProgressBar" class="bg-primary-light h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                            </div>

                            <div id="analysisResults" class="mt-6 hidden">
                                <h4 class="font-medium text-green-600 dark:text-green-400 mb-3">
                                    <i class="fas fa-check-circle mr-2"></i>Analysis Complete!
                                </h4>
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div class="bg-background-light dark:bg-background-dark rounded-lg p-3">
                                        <span class="text-sm font-medium">Reports Analyzed:</span>
                                        <span id="reportsCount" class="text-primary-light dark:text-primary-dark font-bold ml-2">0</span>
                                    </div>
                                    <div class="bg-background-light dark:bg-background-dark rounded-lg p-3">
                                        <span class="text-sm font-medium">Health Markers:</span>
                                        <span id="markersCount" class="text-primary-light dark:text-primary-dark font-bold ml-2">0</span>
                                    </div>
                                </div>
                                <div id="keyFindings" class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                                    <h5 class="font-medium text-blue-800 dark:text-blue-200 mb-2">Key Findings:</h5>
                                    <ul id="findingsList" class="space-y-1 text-sm text-blue-700 dark:text-blue-300"></ul>
                                </div>
                            </div>
                        </div>

                        <!-- Recommended Meals Section -->
                        <div class="health-card bg-card-light dark:bg-card-dark p-6 rounded-2xl shadow-soft">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-semibold">AI-Generated Meal Recommendations</h3>
                                <div class="flex items-center space-x-2">
                                    <button id="refreshMealsBtn" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all" title="Refresh recommendations">
                                        <i class="fas fa-sync-alt text-primary-light dark:text-primary-dark"></i>
                                    </button>
                                    <button id="saveMealPlanBtn" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all" title="Save meal plan">
                                        <i class="fas fa-bookmark text-primary-light dark:text-primary-dark"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div id="mealRecommendations" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Default meals will be loaded here -->
                                <div class="meal-card bg-background-light dark:bg-background-dark rounded-xl overflow-hidden hover:shadow-lg transition-all duration-300">
                                    <img src="https://images.unsplash.com/photo-1505576399279-565b52d4ac71?auto=format&fit=crop&w=800" 
                                         alt="Quinoa Salad" class="w-full h-32 object-cover">
                                    <div class="p-4">
                                        <h4 class="font-medium mb-2">Quinoa Salad</h4>
                                        <div class="text-sm text-muted-light dark:text-muted-dark space-y-1">
                                            <p><strong>Calories:</strong> 320 | <strong>Protein:</strong> 15g | <strong>Carbs:</strong> 45g</p>
                                            <p class="text-xs mt-2"><strong>Benefits:</strong> High in fiber, complete protein, gluten-free</p>
                                        </div>
                                        <div class="flex items-center justify-between mt-3">
                                            <span class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-full">Recommended</span>
                                            <button class="text-primary-light dark:text-primary-dark hover:underline text-sm">View Recipe</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="meal-card bg-background-light dark:bg-background-dark rounded-xl overflow-hidden hover:shadow-lg transition-all duration-300">
                                    <img src="https://images.unsplash.com/photo-1467003909585-2f8a72700288?auto=format&fit=crop&w=800" 
                                         alt="Overnight Oats" class="w-full h-32 object-cover">
                                    <div class="p-4">
                                        <h4 class="font-medium mb-2">Overnight Oats</h4>
                                        <div class="text-sm text-muted-light dark:text-muted-dark space-y-1">
                                            <p><strong>Calories:</strong> 250 | <strong>Protein:</strong> 8g | <strong>Carbs:</strong> 40g</p>
                                            <p class="text-xs mt-2"><strong>Benefits:</strong> High fiber, heart-healthy, sustained energy</p>
                                        </div>
                                        <div class="flex items-center justify-between mt-3">
                                            <span class="text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full">Heart Healthy</span>
                                            <button class="text-primary-light dark:text-primary-dark hover:underline text-sm">View Recipe</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="personalizedMealPlan" class="mt-8 hidden">
                                <h4 class="font-medium text-primary-light dark:text-primary-dark mb-4">
                                    <i class="fas fa-user-md mr-2"></i>Personalized Based on Your Lab Results
                                </h4>
                                <div id="personalizedMeals" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Personalized meals will be added here -->
                                </div>
                            </div>

                            <div class="mt-8">
                                <div class="bg-background-light dark:bg-background-dark p-4 rounded-xl">
                                    <p class="text-sm text-muted-light dark:text-muted-dark mb-2">
                                        <span class="font-medium text-red-500">Disclaimer:</span> The recommendations provided are AI-generated and should be considered supplementary to professional medical advice.
                                    </p>
                                </div>
                                
                                <div class="mt-4 bg-gradient-to-r from-primary-light/10 to-purple-600/10 border border-primary-light/20 p-4 rounded-xl">
                                    <p class="text-sm text-muted-light dark:text-muted-dark">
                                        <span class="font-medium text-primary-light dark:text-primary-dark">
                                            <i class="fas fa-lightbulb mr-2"></i>Smart Recommendations:
                                        </span> 
                                        Upload your lab reports for AI-powered personalized meal plans based on your specific health markers and nutritional needs.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="md:col-span-4">
                        <div class="health-card bg-card-light dark:bg-card-dark p-6 rounded-2xl shadow-soft mb-6">
                            <h3 class="text-xl font-semibold mb-6">Nutritional Insights</h3>
                            
                            <div id="nutritionalInsights" class="space-y-4">
                                <div class="bg-background-light dark:bg-background-dark rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-medium">Daily Calories</span>
                                        <span id="dailyCalories" class="text-primary-light dark:text-primary-dark font-bold">2000</span>
                                    </div>
                                    <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full">
                                        <div id="caloriesProgress" class="h-full bg-green-500 rounded-full" style="width: 65%"></div>
                                    </div>
                                    <p class="text-xs text-muted-light dark:text-muted-dark mt-1">Target: 2000 calories</p>
                                </div>

                                <div class="bg-background-light dark:bg-background-dark rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-medium">Protein Intake</span>
                                        <span id="proteinIntake" class="text-blue-600 dark:text-blue-400 font-bold">45g</span>
                                    </div>
                                    <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full">
                                        <div id="proteinProgress" class="h-full bg-blue-500 rounded-full" style="width: 60%"></div>
                                    </div>
                                    <p class="text-xs text-muted-light dark:text-muted-dark mt-1">Target: 75g protein</p>
                                </div>

                                <div class="bg-background-light dark:bg-background-dark rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-medium">Fiber Intake</span>
                                        <span id="fiberIntake" class="text-purple-600 dark:text-purple-400 font-bold">18g</span>
                                    </div>
                                    <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full">
                                        <div id="fiberProgress" class="h-full bg-purple-500 rounded-full" style="width: 72%"></div>
                                    </div>
                                    <p class="text-xs text-muted-light dark:text-muted-dark mt-1">Target: 25g fiber</p>
                                </div>
                            </div>

                            <div id="healthAlerts" class="mt-6 space-y-3">
                                <h4 class="font-medium text-orange-600 dark:text-orange-400">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>Health Alerts
                                </h4>
                                <div class="bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-3">
                                    <p class="text-sm text-orange-800 dark:text-orange-200">Upload lab reports to receive personalized health alerts and recommendations.</p>
                                </div>
                            </div>
                        </div>

                        <div class="health-card bg-card-light dark:bg-card-dark p-6 rounded-2xl shadow-soft">
                            <h3 class="text-xl font-semibold mb-6">Lifestyle Guidance</h3>
                            
                            <div id="lifestyleGuidance" class="space-y-6">
                                <div>
                                    <h4 class="font-medium text-primary-light dark:text-primary-dark mb-2">Exercise Tips</h4>
                                    <p class="text-sm text-muted-light dark:text-muted-dark">Engage in 30 minutes of moderate activity daily.</p>
                                </div>
                                
                                <div>
                                    <h4 class="font-medium text-primary-light dark:text-primary-dark mb-2">Sleep Advice</h4>
                                    <p class="text-sm text-muted-light dark:text-muted-dark">Aim for 7-8 hours of quality sleep each night.</p>
                                </div>
                                
                                <div>
                                    <h4 class="font-medium text-primary-light dark:text-primary-dark mb-2">Hydration Guidance</h4>
                                    <p class="text-sm text-muted-light dark:text-muted-dark">Drink at least 8 cups of water daily.</p>
                                </div>

                                <div id="personalizedGuidance" class="hidden">
                                    <h4 class="font-medium text-green-600 dark:text-green-400 mb-2">
                                        <i class="fas fa-user-check mr-2"></i>Personalized for You
                                    </h4>
                                    <div id="personalizedAdvice" class="space-y-2 text-sm text-muted-light dark:text-muted-dark">
                                        <!-- Personalized advice will be added here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        
        <section id="firstaid" class="mb-16">
            <h2 class="text-3xl font-bold mb-8 text-center">First Aid & Medicine Suggestions</h2>
            
            <div class="health-card bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-md">
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Symptom Checker</h3>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">Select Symptoms</label>
                            <select multiple class="w-full p-2 border rounded-md h-40 dark:bg-gray-700 dark:border-gray-600">
                                <option>Headache</option>
                                <option>Fever</option>
                                <option>Cough</option>
                                <option>Stomach ache</option>
                                <option>Nausea</option>
                                <option>Dizziness</option>
                                <option>Muscle pain</option>
                                <option>Sore throat</option>
                                <option>Runny nose</option>
                                <option>Rash</option>
                            </select>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Hold Ctrl/Cmd to select multiple symptoms</p>
                        </div>
                        
                        <button class="w-full bg-primary-light dark:bg-primary-dark text-white py-2 rounded-md font-medium">
                            Get Recommendations
                        </button>
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Recommended Actions</h3>
                        
                        <div class="p-4 bg-red-50 dark:bg-red-900/20 rounded-md mb-4">
                            <p class="text-sm"><span class="font-medium">Emergency Disclaimer:</span> In case of severe symptoms, immediately contact a healthcare professional.</p>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                            <h4 class="font-medium mb-2">For Headache & Fever</h4>
                            <ul class="list-disc pl-5 space-y-1 text-sm">
                                <li>Rest in a quiet, dark room</li>
                                <li>Apply a cool compress to your forehead</li>
                                <li>Stay hydrated with water or electrolyte solutions</li>
                                <li>Consider OTC pain relievers like Paracetamol or Ibuprofen</li>
                            </ul>
                            
                            <div class="mt-4 pt-3 border-t border-gray-200 dark:border-gray-700">
                                <h4 class="font-medium mb-2">Commonly Available Medicines</h4>
                                <div class="flex flex-wrap gap-2">
                                    <span class="bg-white dark:bg-gray-700 px-2 py-1 rounded text-sm">Paracetamol</span>
                                    <span class="bg-white dark:bg-gray-700 px-2 py-1 rounded text-sm">Ibuprofen</span>
                                    <span class="bg-white dark:bg-gray-700 px-2 py-1 rounded text-sm">Aspirin</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        
        <section id="rural" class="mb-16">
            <h2 class="text-3xl font-bold mb-8 text-center">Rural Healthcare Support</h2>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div class="health-card bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-semibold mb-4">Find Nearby Facilities</h3>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1">Your Location</label>
                        <input type="text" id="locationInput" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" placeholder="Enter your area or zip code">
                        <button id="detectLocationBtn" class="mt-2 text-sm text-primary-light dark:text-primary-dark hover:underline">
                            <i class="fas fa-location-arrow mr-1"></i>Auto-detect my location
                        </button>
                    </div>
                    
                    <button id="searchFacilitiesBtn" class="w-full bg-primary-light dark:bg-primary-dark text-white py-2 rounded-md font-medium mb-6">
                        Search Nearby Facilities
                    </button>
                    
                    <div id="facilitiesContainer" class="space-y-4">
                        <div class="p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
                            <h4 class="font-medium">Community Health Center</h4>
                            <p class="text-sm mt-1">123 Main Street, Village</p>
                            <p class="text-sm"><i class="fas fa-phone-alt mr-2"></i> +91 1234567891</p>
                            <p class="text-sm text-green-600 dark:text-green-400 mt-2"><i class="fas fa-map-marker-alt mr-1"></i> 2.3 km away</p>
                        </div>
                        
                        <div class="p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
                            <h4 class="font-medium">Rural Medical Clinic</h4>
                            <p class="text-sm mt-1">456 Oak Avenue, Countryside</p>
                            <p class="text-sm"><i class="fas fa-phone-alt mr-2"></i> +1 (555) 987-6543</p>
                            <p class="text-sm text-green-600 dark:text-green-400 mt-2"><i class="fas fa-map-marker-alt mr-1"></i> 5.1 km away</p>
                        </div>
                    </div>
                </div>
                
                <div class="health-card bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-semibold mb-4">Local Food Alternatives</h3>
                    
                    <div class="space-y-4">
                        <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                            <h4 class="font-medium">Instead of Quinoa</h4>
                            <p class="mt-1">Try locally available millets, brown rice, or barley</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Similar nutritional profile, more affordable</p>
                        </div>
                        
                        <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                            <h4 class="font-medium">Instead of Salmon</h4>
                            <p class="mt-1">Try locally available fish like mackerel, sardines, or freshwater fish</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Good source of Omega-3 fatty acids</p>
                        </div>
                        
                        <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                            <h4 class="font-medium">Instead of Kale</h4>
                            <p class="mt-1">Try spinach, mustard greens, or other local leafy vegetables</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Rich in vitamins and minerals</p>
                        </div>
                        
                        <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                            <h4 class="font-medium">Instead of Almond Milk</h4>
                            <p class="mt-1">Try homemade peanut milk or coconut milk</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Locally sourced, cost-effective alternatives</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        
        <section class="mb-16">
            <h2 class="text-3xl font-bold mb-8 text-center">Interactive Features</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 justify-center items-stretch">
                <!-- Health Profile Card -->
                <div class="flex-1 min-w-[220px] bg-card-light dark:bg-card-dark rounded-2xl shadow-md p-6 flex flex-col items-center transition-all duration-300 hover:scale-105 hover:shadow-lg cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/20">
                    <span class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900 mb-4">
                        <i class="fas fa-user-circle text-3xl text-blue-500"></i>
                    </span>
                    <h3 class="text-xl font-semibold mb-2 text-center">Health Profile</h3>
                    <p class="text-sm text-center text-muted-light dark:text-muted-dark">Track your health journey and set personal goals.</p>
                </div>
                <!-- Nutriscan Survey Card -->
                <div class="flex-1 min-w-[220px] bg-card-light dark:bg-card-dark rounded-2xl shadow-md p-6 flex flex-col items-center transition-all duration-300 hover:scale-105 hover:shadow-lg cursor-pointer hover:bg-green-50 dark:hover:bg-green-900/20">
                    <span class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-green-100 dark:bg-green-900 mb-4">
                        <i class="fas fa-chart-bar text-3xl text-green-500"></i>
                    </span>
                    <h3 class="text-xl font-semibold mb-2 text-center">Nutriscan Survey</h3>
                    <p class="text-sm text-center text-muted-light dark:text-muted-dark">Complete wellness surveys for personalized insights.</p>
                </div>
                <!-- AI Meal Plans Card -->
                <div class="flex-1 min-w-[220px] bg-card-light dark:bg-card-dark rounded-2xl shadow-md p-6 flex flex-col items-center transition-all duration-300 hover:scale-105 hover:shadow-lg cursor-pointer hover:bg-yellow-50 dark:hover:bg-yellow-900/20">
                    <span class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-yellow-100 dark:bg-yellow-900 mb-4">
                        <i class="fas fa-robot text-3xl text-yellow-500"></i>
                    </span>
                    <h3 class="text-xl font-semibold mb-2 text-center text-yellow-500">AI Meal Plans</h3>
                    <p class="text-sm text-center text-muted-light dark:text-muted-dark">Get personalized meal recommendations based on your health data.</p>
                </div>
                <!-- First Aid Guide Card -->
                <div class="flex-1 min-w-[220px] bg-card-light dark:bg-card-dark rounded-2xl shadow-md p-6 flex flex-col items-center transition-all duration-300 hover:scale-105 hover:shadow-lg cursor-pointer hover:bg-red-50 dark:hover:bg-red-900/20">
                    <span class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-red-100 dark:bg-red-900 mb-4">
                        <i class="fas fa-kit-medical text-3xl text-red-500"></i>
                    </span>
                    <h3 class="text-xl font-semibold mb-2 text-center">First Aid Guide</h3>
                    <p class="text-sm text-center text-muted-light dark:text-muted-dark">Access quick medical advice and medicine suggestions.</p>
                </div>
                <!-- Rural Healthcare Locator Card -->
                <div class="flex-1 min-w-[220px] bg-card-light dark:bg-card-dark rounded-2xl shadow-md p-6 flex flex-col items-center transition-all duration-300 hover:scale-105 hover:shadow-lg cursor-pointer hover:bg-purple-50 dark:hover:bg-purple-900/20">
                    <span class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-purple-100 dark:bg-purple-900 mb-4">
                        <i class="fas fa-hospital-alt text-3xl text-purple-500"></i>
                    </span>
                    <h3 class="text-xl font-semibold mb-2 text-center">Rural Healthcare</h3>
                    <p class="text-sm text-center text-muted-light dark:text-muted-dark">Find nearby hospitals and healthcare facilities in rural areas.</p>
                </div>
                <!-- Water & Sanitation Card -->
                <div class="flex-1 min-w-[220px] bg-card-light dark:bg-card-dark rounded-2xl shadow-md p-6 flex flex-col items-center transition-all duration-300 hover:scale-105 hover:shadow-lg cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/20">
                    <span class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-cyan-100 dark:bg-cyan-900 mb-4">
                        <i class="fas fa-droplet text-3xl text-cyan-500"></i>
                    </span>
                    <h3 class="text-xl font-semibold mb-2 text-center">Water & Sanitation</h3>
                    <p class="text-sm text-center text-muted-light dark:text-muted-dark">Access clean water resources and sanitation facilities.</p>
                </div>
            </div>
        </section>
    </main>

    
    <div class="fixed bottom-6 right-6 z-10">
        <div class="relative">
            <button id="chatbotToggle" class="chatbot-icon w-14 h-14 rounded-full bg-primary-light dark:bg-primary-dark text-white flex items-center justify-center shadow-lg">
                <i class="fas fa-robot text-xl"></i>
                <span class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full"></span>
            </button>
            
            <div id="chatbotWindow" class="hidden absolute bottom-16 right-0 w-80 h-96 bg-card-light dark:bg-card-dark rounded-lg shadow-xl flex flex-col">
                <div class="bg-primary-light dark:bg-primary-dark text-white p-4 rounded-t-lg flex justify-between items-center">
                    <h3 class="font-semibold">Health Assistant ðŸ¤–</h3>
                    <button id="chatbotClose" class="text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="chatMessages" class="flex-1 p-4 overflow-y-auto">
                    <div class="mb-4">
                        <div class="bg-gray-100 dark:bg-gray-700 chat-bubble p-3 max-w-xs">
                            <p class="text-sm">Hello! I'm your Health Assistant. How can I help you today?</p>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Just now</p>
                    </div>
                </div>
                
                <div class="p-3 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex">
                        <input type="text" placeholder="Type your message..." class="flex-1 border rounded-l-md p-2 text-sm dark:bg-gray-700 dark:border-gray-600">
                        <button class="bg-primary-light dark:bg-primary-dark text-white px-4 rounded-r-md">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <footer class="bg-card-light dark:bg-card-dark py-8 px-6 border-t border-gray-200 dark:border-gray-700">
        <div class="container mx-auto">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <h4 class="font-semibold mb-4">HealthGuide</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Your AI-powered health and nutrition assistant for better lifestyle choices.</p>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-4">Quick Links</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-600 dark:text-gray-400 hover:text-primary-light dark:hover:text-primary-dark">About Us</a></li>
                        <li><a href="#" class="text-gray-600 dark:text-gray-400 hover:text-primary-light dark:hover:text-primary-dark">Features</a></li>
                        <li><a href="#" class="text-gray-600 dark:text-gray-400 hover:text-primary-light dark:hover:text-primary-dark">FAQ</a></li>
                        <li><a href="#" class="text-gray-600 dark:text-gray-400 hover:text-primary-light dark:hover:text-primary-dark">Contact</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-4">Legal</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-600 dark:text-gray-400 hover:text-primary-light dark:hover:text-primary-dark">Privacy Policy</a></li>
                        <li><a href="#" class="text-gray-600 dark:text-gray-400 hover:text-primary-light dark:hover:text-primary-dark">Terms of Service</a></li>
                        <li><a href="#" class="text-gray-600 dark:text-gray-400 hover:text-primary-light dark:hover:text-primary-dark">Data Security</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-4">Contact Us</h4>
                    <ul class="space-y-2 text-sm">
                        <li class="flex items-center">
                            <i class="fas fa-envelope mr-2 text-gray-600 dark:text-gray-400"></i>
                            <span class="text-gray-600 dark:text-gray-400">support@healthguide.com</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-phone-alt mr-2 text-gray-600 dark:text-gray-400"></i>
                            <span class="text-gray-600 dark:text-gray-400">+91 1234567891</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-200 dark:border-gray-700 mt-8 pt-6 text-center text-sm text-gray-600 dark:text-gray-400">
                <p>Â© 2023 HealthGuide. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div id="addGoalModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="modal-content bg-card-light dark:bg-card-dark rounded-3xl shadow-2xl max-w-md w-full mx-4 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-primary"></div>
            
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold bg-gradient-to-r from-primary-light to-purple-600 bg-clip-text text-transparent">Add New Goal</h3>
                    <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <form id="goalForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Goal Type</label>
                        <select id="goalType" class="w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-light dark:focus:ring-primary-dark focus:border-transparent transition-all">
                            <option value="">Select a goal type</option>
                            <option value="water">Water Intake</option>
                            <option value="exercise">Exercise/Fitness</option>
                            <option value="sleep">Sleep Schedule</option>
                            <option value="meditation">Meditation</option>
                            <option value="nutrition">Nutrition</option>
                            <option value="weight">Weight Management</option>
                            <option value="steps">Daily Steps</option>
                            <option value="custom">Custom Goal</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Goal Title</label>
                        <input type="text" id="goalTitle" placeholder="e.g., Drink 8 glasses of water daily" 
                               class="w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-primary-light dark:focus:ring-primary-dark focus:border-transparent transition-all">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Target Value</label>
                            <input type="number" id="goalTarget" placeholder="8" 
                                   class="w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-primary-light dark:focus:ring-primary-dark focus:border-transparent transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Unit</label>
                            <input type="text" id="goalUnit" placeholder="glasses" 
                                   class="w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-primary-light dark:focus:ring-primary-dark focus:border-transparent transition-all">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Frequency</label>
                        <select id="goalFrequency" class="w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-light dark:focus:ring-primary-dark focus:border-transparent transition-all">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Priority</label>
                        <select id="goalPriority" class="w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-light dark:focus:ring-primary-dark focus:border-transparent transition-all">
                            <option value="low">Low Priority</option>
                            <option value="medium" selected>Medium Priority</option>
                            <option value="high">High Priority</option>
                        </select>
                    </div>

                    <div class="flex space-x-3 pt-4">
                        <button type="button" id="cancelGoalBtn" class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-all font-medium">
                            Cancel
                        </button>
                        <button type="submit" class="flex-1 gradient-primary text-white px-4 py-3 rounded-xl font-medium hover:scale-105 transition-all shadow-lg">
                            <i class="fas fa-plus mr-2"></i>Add Goal
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Theme Toggle Functionality
        const themeToggle = document.getElementById('themeToggle');
        const htmlElement = document.documentElement;
        
        // Check for saved theme preference or respect OS preference
        if (localStorage.getItem('theme') === 'dark' || 
            (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            htmlElement.classList.add('dark');
            themeToggle.innerHTML = '<i class="fas fa-sun text-yellow-300"></i>';
        } else {
            htmlElement.classList.remove('dark');
            themeToggle.innerHTML = '<i class="fas fa-moon text-gray-700"></i>';
        }
        
        // Toggle theme on button click
        themeToggle.addEventListener('click', () => {
            if (htmlElement.classList.contains('dark')) {
                htmlElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                themeToggle.innerHTML = '<i class="fas fa-moon text-gray-700"></i>';
            } else {
                htmlElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                themeToggle.innerHTML = '<i class="fas fa-sun text-yellow-300"></i>';
            }
        });
        
        // Chatbot Toggle Functionality
        const chatbotToggle = document.getElementById('chatbotToggle');
        const chatbotClose = document.getElementById('chatbotClose');
        const chatbotWindow = document.getElementById('chatbotWindow');
        
        chatbotToggle.addEventListener('click', () => {
            chatbotWindow.classList.toggle('hidden');
        });
        
        chatbotClose.addEventListener('click', () => {
            chatbotWindow.classList.add('hidden');
        });
        
        // Gemini AI Chatbot Implementation
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.querySelector('#chatbotWindow input');
        const chatSend = document.querySelector('#chatbotWindow button');
        
        // Store conversation session ID
        let sessionId = generateSessionId();
        
        // Generate unique session ID
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        chatSend.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Disable input while processing
            chatInput.disabled = true;
            chatSend.disabled = true;
            
            // Add user message
            addUserMessage(message);
            
            // Clear input
            chatInput.value = '';
            
            // Show typing indicator
            const typingIndicator = addTypingIndicator();
            
            try {
                // Send message to Gemini API
                const response = await fetch('http://localhost:5000/api/chatbot/chat-with-history', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        message: message,
                        sessionId: sessionId
                    })
                });
                
                const data = await response.json();
                
                // Remove typing indicator
                typingIndicator.remove();
                
                if (data.success) {
                    addBotMessage(data.response);
                } else {
                    addBotMessage('Sorry, I encountered an error. Please try again.');
                }
                
            } catch (error) {
                console.error('Chat error:', error);
                typingIndicator.remove();
                addBotMessage('Sorry, I\'m having trouble connecting. Please check if the server is running.');
            }
            
            // Re-enable input
            chatInput.disabled = false;
            chatSend.disabled = false;
            chatInput.focus();
        }
        
        function addUserMessage(message) {
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'mb-4 flex justify-end';
            userMessageDiv.innerHTML = `
                <div>
                    <div class="bg-primary-light dark:bg-primary-dark text-white user-bubble p-3 max-w-xs">
                        <p class="text-sm">${escapeHtml(message)}</p>
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 text-right">Just now</p>
                </div>
            `;
            chatMessages.appendChild(userMessageDiv);
            scrollToBottom();
        }
        
        function addBotMessage(message) {
            const aiMessageDiv = document.createElement('div');
            aiMessageDiv.className = 'mb-4';
            aiMessageDiv.innerHTML = `
                <div class="bg-gray-100 dark:bg-gray-700 chat-bubble p-3 max-w-xs">
                    <p class="text-sm">${escapeHtml(message)}</p>
                </div>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Just now</p>
            `;
            chatMessages.appendChild(aiMessageDiv);
            scrollToBottom();
        }
        
        function addTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'mb-4 typing-indicator';
            typingDiv.innerHTML = `
                <div class="bg-gray-100 dark:bg-gray-700 chat-bubble p-3 max-w-xs">
                    <p class="text-sm text-gray-500">
                        <span class="inline-block w-2 h-2 bg-gray-400 rounded-full mr-1 animate-bounce"></span>
                        <span class="inline-block w-2 h-2 bg-gray-400 rounded-full mr-1 animate-bounce" style="animation-delay: 0.1s"></span>
                        <span class="inline-block w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
                    </p>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            scrollToBottom();
            return typingDiv;
        }
        
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Clear conversation button (optional)
        function clearConversation() {
            sessionId = generateSessionId();
            // Keep only the initial greeting message
            const initialMessage = chatMessages.querySelector('.mb-4');
            chatMessages.innerHTML = '';
            if (initialMessage) {
                chatMessages.appendChild(initialMessage);
            }
        }
        
        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: 'smooth'
                    });
                }
            });
        });
        
        // Authentication Guard Functions
        function checkAuthentication() {
            const token = localStorage.getItem('token');
            if (!token) {
                showAuthenticationRequired();
                protectInteractiveElements();
                return false;
            }
            return true;
        }

        function protectInteractiveElements() {
            // Disable all buttons, forms, and interactive elements except auth buttons and demo button
            const interactiveElements = document.querySelectorAll('button:not(#themeToggle):not(.auth-required-btn):not(#authOverlay button):not(#watchDemoBtn), input, textarea, select, [onclick]:not(#authOverlay [onclick])');
            interactiveElements.forEach(element => {
                element.style.pointerEvents = 'none';
                element.style.opacity = '0.5';
                element.style.filter = 'grayscale(80%)';
                if (element.tagName.toLowerCase() === 'button') {
                    element.disabled = true;
                }
            });
            
            // Ensure Watch Demo button remains fully functional
            const watchDemoBtn = document.getElementById('watchDemoBtn');
            if (watchDemoBtn) {
                watchDemoBtn.style.pointerEvents = 'auto';
                watchDemoBtn.style.opacity = '1';
                watchDemoBtn.style.filter = 'none';
                watchDemoBtn.disabled = false;
            }
            
            // Add locked overlay to main content sections
            const mainSections = document.querySelectorAll('section:not(.auth-overlay)');
            mainSections.forEach(section => {
                section.style.position = 'relative';
                if (!section.querySelector('.locked-overlay')) {
                    const overlay = document.createElement('div');
                    overlay.className = 'locked-overlay absolute inset-0 bg-black/10 backdrop-blur-[1px] z-10 flex items-center justify-center';
                    overlay.innerHTML = `
                        <div class="bg-white/90 dark:bg-gray-800/90 rounded-xl p-4 shadow-lg flex items-center space-x-3">
                            <i class="fas fa-lock text-red-500"></i>
                            <span class="text-sm font-medium">Authentication Required</span>
                        </div>
                    `;
                    section.appendChild(overlay);
                }
            });
        }

        function enableInteractiveElements() {
            // Re-enable all interactive elements
            const interactiveElements = document.querySelectorAll('button:not(#themeToggle), input, textarea, select, [onclick]');
            interactiveElements.forEach(element => {
                element.style.pointerEvents = 'auto';
                element.style.opacity = '1';
                element.style.filter = 'none';
                if (element.tagName.toLowerCase() === 'button') {
                    element.disabled = false;
                }
            });
            
            // Remove locked overlays
            const lockedOverlays = document.querySelectorAll('.locked-overlay');
            lockedOverlays.forEach(overlay => overlay.remove());
        }

        function showAuthenticationRequired() {
            // Show overlay blocking access to content
            const authOverlay = document.createElement('div');
            authOverlay.id = 'authOverlay';
            authOverlay.className = 'auth-overlay fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center';
            authOverlay.innerHTML = `
                <div class="bg-card-light dark:bg-card-dark rounded-3xl shadow-2xl max-w-md w-full mx-4 p-8 text-center">
                    <div class="mb-6">
                        <div class="w-20 h-20 bg-gradient-primary rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-lock text-white text-2xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold mb-2">Authentication Required</h2>
                        <p class="text-muted-light dark:text-muted-dark">
                            Please login or signup to access HealthGuide features and protect your health data.
                        </p>
                    </div>
                    
                    <div class="space-y-4">
                        <button id="authRedirectBtn" onclick="redirectToAuth()" class="auth-required-btn w-full gradient-primary text-white py-4 rounded-xl font-medium hover:shadow-lg hover:scale-105 transition-all duration-300 cursor-pointer" style="z-index: 9999; position: relative;">
                            <i class="fas fa-sign-in-alt mr-2"></i>
                            Login / Sign Up
                        </button>
                        <p class="text-sm text-muted-light dark:text-muted-dark">
                            Your health data is protected and secure with us.
                        </p>
                        
                        <div class="mt-6 flex items-center justify-center space-x-6 text-sm text-muted-light dark:text-muted-dark">
                            <div class="flex items-center">
                                <i class="fas fa-shield-alt text-green-500 mr-2"></i>
                                <span>Secure</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-lock text-blue-500 mr-2"></i>
                                <span>Private</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-user-md text-purple-500 mr-2"></i>
                                <span>Professional</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(authOverlay);
            
            // Add event listener to the auth button
            const authBtn = document.getElementById('authRedirectBtn');
            if (authBtn) {
                authBtn.addEventListener('click', function(e) {
                    console.log('Auth button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Add visual feedback
                    authBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Redirecting...';
                    authBtn.disabled = true;
                    
                    // Redirect after a brief delay to show feedback
                    setTimeout(() => {
                        window.location.href = 'auth.html';
                    }, 500);
                });
            }
            
            // Block all interactions with main content
            const mainContent = document.body;
            mainContent.style.overflow = 'hidden';
        }

        function redirectToAuth() {
            console.log('Redirecting to auth page...');
            try {
                window.location.href = 'auth.html';
            } catch (error) {
                console.error('Navigation error:', error);
                // Fallback method
                window.open('auth.html', '_self');
            }
        }

        // Make function globally accessible
        window.redirectToAuth = redirectToAuth;

        function initializeAuthenticatedFeatures() {
            // Only initialize features if user is authenticated
            if (!checkAuthentication()) {
                return;
            }
            
            // Initialize all interactive features
            initializeFirstAidFeatures();
            initializeChatFeatures();
            initializeGoalsFeatures();
            initializeMealPlanFeatures();
            initializeHealthTracking();
            initializeLocationFeatures();
        }

        // Sample data for interactive elements
        document.addEventListener('DOMContentLoaded', function() {
            // First check authentication
            if (!checkAuthentication()) {
                return; // Stop execution if not authenticated
            }
            
            // Update profile UI with user data from token
            updateProfileUI();
            
            // Add logout button event listener
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
            
            // Initialize all authenticated features
            initializeAuthenticatedFeatures();
            
            // Initialize hero section features
            initializeHeroFeatures();
            
            // Enable interactive elements for authenticated users
            enableInteractiveElements();
            
            // Simulate loading of user data
            setTimeout(() => {
                const healthScore = document.querySelector('.health-card .text-2xl');
                if (healthScore) {
                    healthScore.textContent = '';
                }
            }, 500);
        });
            
            // First Aid & Medicine Recommendations functionality
            const symptomSelect = document.querySelector('#firstaid select[multiple]');
            const recommendBtn = document.querySelector('#firstaid button');
            const disclaimerDiv = document.querySelector('#firstaid .bg-red-50');
            const actionsDiv = document.querySelector('#firstaid .bg-gray-50');
            
            if (recommendBtn && symptomSelect) {
                recommendBtn.addEventListener('click', async function() {
                    const selectedOptions = Array.from(symptomSelect.selectedOptions);
                    const symptoms = selectedOptions.map(option => option.value);
                    
                    if (symptoms.length === 0) {
                        alert('Please select at least one symptom');
                        return;
                    }
                    
                    // Show loading state
                    recommendBtn.textContent = 'Loading...';
                    recommendBtn.disabled = true;
                    
                    try {
                        const response = await fetch('http://localhost:3000/api/firstaid', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ symptoms: symptoms })
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            // Update disclaimer
                            if (data.disclaimer) {
                                disclaimerDiv.innerHTML = `<p class="text-sm"><span class="font-medium">Emergency Disclaimer:</span> ${data.disclaimer}</p>`;
                            }
                            
                            // Update actions
                            let actionsHTML = `<h4 class="font-medium mb-2">Recommended Actions for ${symptoms.join(', ')}</h4>`;
                            if (data.actions && data.actions.length > 0) {
                                actionsHTML += '<ul class="list-disc pl-5 space-y-1 text-sm">';
                                data.actions.forEach(action => {
                                    actionsHTML += `<li>${action}</li>`;
                                });
                                actionsHTML += '</ul>';
                            }
                            
                            // Update medicines
                            if (data.medicines && data.medicines.length > 0) {
                                actionsHTML += `
                                    <div class="mt-4 pt-3 border-t border-gray-200 dark:border-gray-700">
                                        <h4 class="font-medium mb-2">Recommended Medicines</h4>
                                        <div class="flex flex-wrap gap-2">
                                `;
                                data.medicines.forEach(medicine => {
                                    actionsHTML += `<span class="bg-white dark:bg-gray-700 px-2 py-1 rounded text-sm">${medicine}</span>`;
                                });
                                actionsHTML += '</div></div>';
                            }
                            
                            actionsDiv.innerHTML = actionsHTML;
                        } else {
                            alert('Error getting recommendations: ' + (data.error || 'Unknown error'));
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Failed to connect to server. Make sure the backend is running on port 3000.');
                    } finally {
                        // Reset button
                        recommendBtn.textContent = 'Get Recommendations';
                        recommendBtn.disabled = false;
                    }
                });
            }
            
            // Location Detection and Facility Search functionality
            const locationInput = document.getElementById('locationInput');
            const detectLocationBtn = document.getElementById('detectLocationBtn');
            const searchFacilitiesBtn = document.getElementById('searchFacilitiesBtn');
            const facilitiesContainer = document.getElementById('facilitiesContainer');
            
            let userCoordinates = null;
            
            // Auto-detect location functionality
            if (detectLocationBtn) {
                detectLocationBtn.addEventListener('click', function() {
                    if (navigator.geolocation) {
                        detectLocationBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>Detecting...';
                        
                        navigator.geolocation.getCurrentPosition(
                            function(position) {
                                userCoordinates = {
                                    latitude: position.coords.latitude,
                                    longitude: position.coords.longitude
                                };
                                locationInput.value = `Lat: ${position.coords.latitude.toFixed(4)}, Lng: ${position.coords.longitude.toFixed(4)}`;
                                detectLocationBtn.innerHTML = '<i class="fas fa-check mr-1"></i>Location detected';
                                detectLocationBtn.style.color = 'green';
                            },
                            function(error) {
                                console.error('Geolocation error:', error);
                                alert('Unable to detect location. Please enter manually.');
                                detectLocationBtn.innerHTML = '<i class="fas fa-location-arrow mr-1"></i>Auto-detect my location';
                            }
                        );
                    } else {
                        alert('Geolocation is not supported by this browser.');
                    }
                });
            }
            
            // Search nearby facilities functionality
            if (searchFacilitiesBtn) {
                searchFacilitiesBtn.addEventListener('click', async function() {
                    const location = locationInput.value.trim();
                    
                    if (!location && !userCoordinates) {
                        alert('Please enter a location or use auto-detect');
                        return;
                    }
                    
                    // Show loading state
                    searchFacilitiesBtn.textContent = 'Searching...';
                    searchFacilitiesBtn.disabled = true;
                    
                    try {
                        const requestBody = userCoordinates ? 
                            { latitude: userCoordinates.latitude, longitude: userCoordinates.longitude } :
                            { location: location };
                            
                        const response = await fetch('http://localhost:3000/api/nearby-facilities', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(requestBody)
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok && data.facilities) {
                            // Show message if provided
                            let facilitiesHTML = '';
                            if (data.message) {
                                facilitiesHTML += `
                                    <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg mb-4 border-l-4 border-blue-500">
                                        <p class="text-sm text-blue-700 dark:text-blue-300">
                                            <i class="fas fa-info-circle mr-2"></i>${data.message}
                                        </p>
                                    </div>
                                `;
                            }
                            
                            // Update facilities list
                            data.facilities.forEach(facility => {
                                const typeIcon = facility.type === 'hospital' ? 'fa-hospital' : 
                                               facility.type === 'clinic' ? 'fa-clinic-medical' : 'fa-plus-circle';
                                const typeColor = facility.type === 'hospital' ? 'text-red-600 dark:text-red-400' : 
                                                facility.type === 'clinic' ? 'text-blue-600 dark:text-blue-400' : 'text-green-600 dark:text-green-400';
                                
                                facilitiesHTML += `
                                    <div class="p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border hover:border-primary-light dark:hover:border-primary-dark transition-all">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <div class="flex items-center mb-2">
                                                    <i class="fas ${typeIcon} ${typeColor} mr-2"></i>
                                                    <h4 class="font-medium text-lg">${facility.name}</h4>
                                                    ${facility.type ? `<span class="ml-2 px-2 py-1 text-xs rounded-full bg-primary-light/10 dark:bg-primary-dark/10 text-primary-light dark:text-primary-dark">${facility.type}</span>` : ''}
                                                </div>
                                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">
                                                    <i class="fas fa-map-marker-alt mr-2"></i>${facility.address}
                                                </p>
                                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">
                                                    <i class="fas fa-phone-alt mr-2"></i>${facility.phone}
                                                </p>
                                                <p class="text-sm text-green-600 dark:text-green-400">
                                                    <i class="fas fa-route mr-2"></i>${facility.distance}
                                                </p>
                                            </div>
                                            <button class="ml-4 px-3 py-2 bg-primary-light dark:bg-primary-dark text-white rounded-lg text-sm hover:bg-primary-light/90 dark:hover:bg-primary-dark/90 transition-all">
                                                <i class="fas fa-directions mr-1"></i>Directions
                                            </button>
                                        </div>
                                    </div>
                                `;
                            });
                            facilitiesContainer.innerHTML = facilitiesHTML;
                        } else {
                            alert('Error finding facilities: ' + (data.error || 'Unknown error'));
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Failed to connect to server. Make sure the backend is running on port 3000.');
                    } finally {
                        // Reset button
                        searchFacilitiesBtn.textContent = 'Search Nearby Facilities';
                        searchFacilitiesBtn.disabled = false;
                    }
                });
            }

        // Initialize First Aid & Medicine Recommendations functionality
        function initializeFirstAidFeatures() {
            const symptomSelect = document.querySelector('#firstaid select[multiple]');
            const recommendBtn = document.querySelector('#firstaid button');
            const disclaimerDiv = document.querySelector('#firstaid .bg-red-50');
            const actionsDiv = document.querySelector('#firstaid .bg-gray-50');
            
            if (recommendBtn && symptomSelect) {
                recommendBtn.addEventListener('click', async function() {
                    const selectedOptions = Array.from(symptomSelect.selectedOptions);
                    const symptoms = selectedOptions.map(option => option.value);
                    
                    if (symptoms.length === 0) {
                        showGoalMessage('Please select at least one symptom', 'error');
                        return;
                    }
                    
                    // Show loading state
                    recommendBtn.textContent = 'Loading...';
                    recommendBtn.disabled = true;
                    
                    try {
                        const token = localStorage.getItem('token');
                        const sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                        
                        // Try to call the server API first
                        const response = await fetch('http://localhost:5000/api/chatbot/first-aid', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({ 
                                symptoms,
                                sessionId
                            })
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            
                            if (data.success) {
                                displayFirstAidRecommendations(symptoms, data.recommendations, data.severity, true);
                                showGoalMessage(`Server recommendations generated! (${data.recommendations.length} recommendations)`, 'success');
                            } else {
                                throw new Error(data.error || 'Server returned error');
                            }
                        } else {
                            throw new Error(`Server error: ${response.status}`);
                        }
                        
                    } catch (error) {
                        console.log('ðŸ”„ Server unavailable, using offline recommendations:', error.message);
                        
                        // Fallback to offline recommendations
                        const offlineRecommendations = generateFirstAidRecommendations(symptoms);
                        displayFirstAidRecommendations(symptoms, offlineRecommendations, 'medium', false);
                        showGoalMessage('Offline recommendations generated (Server unavailable)', 'info');
                    } finally {
                        // Reset button
                        recommendBtn.textContent = 'Get Recommendations';
                        recommendBtn.disabled = false;
                    }
                });
            }
        }

        // Function to display first aid recommendations
        function displayFirstAidRecommendations(symptoms, recommendations, severity, fromServer) {
            const firstAidSection = document.querySelector('#firstaid .bg-gray-50');
            
            const severityColors = {
                'low': 'from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 border-green-500',
                'medium': 'from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 border-yellow-500',
                'high': 'from-red-50 to-pink-50 dark:from-red-900/20 dark:to-pink-900/20 border-red-500'
            };
            
            const severityIcons = {
                'low': 'fas fa-info-circle text-green-600',
                'medium': 'fas fa-exclamation-triangle text-yellow-600',
                'high': 'fas fa-exclamation-circle text-red-600'
            };
            
            firstAidSection.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h4 class="font-semibold text-gray-800 dark:text-gray-200">
                        <i class="fas fa-medical-bag mr-2 text-blue-600"></i>
                        Recommendations for: ${symptoms.join(', ')}
                    </h4>
                    <div class="flex items-center space-x-2">
                        <span class="text-xs px-2 py-1 rounded-full ${fromServer ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">
                            ${fromServer ? 'ðŸŒ Server' : 'ðŸ“± Offline'}
                        </span>
                        <span class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-800 capitalize">
                            <i class="${severityIcons[severity] || severityIcons.medium}"></i>
                            ${severity} Priority
                        </span>
                    </div>
                </div>
                
                <div class="space-y-3">
                    ${recommendations.map((rec, index) => `
                        <div class="p-4 bg-gradient-to-r ${severityColors[severity] || severityColors.medium} rounded-xl border-l-4">
                            <div class="flex items-start space-x-3">
                                <div class="flex-shrink-0">
                                    <span class="w-6 h-6 bg-white rounded-full flex items-center justify-center text-sm font-bold text-gray-700">
                                        ${index + 1}
                                    </span>
                                </div>
                                <div class="flex-grow">
                                    <h5 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">${rec.action}</h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed mb-2">${rec.description}</p>
                                    ${rec.priority ? `
                                        <div class="flex items-center space-x-2">
                                            <span class="inline-block px-2 py-1 text-xs font-medium bg-white/50 text-gray-700 rounded-full">
                                                Priority: ${rec.priority}
                                            </span>
                                            ${rec.category ? `<span class="inline-block px-2 py-1 text-xs font-medium bg-white/30 text-gray-600 rounded-full">${rec.category.replace('_', ' ')}</span>` : ''}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                ${severity === 'high' || symptoms.some(s => ['chest pain', 'difficulty breathing', 'severe bleeding'].includes(s.toLowerCase())) ? `
                    <div class="mt-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl">
                        <div class="flex items-center space-x-2 text-red-700 dark:text-red-300 mb-2">
                            <i class="fas fa-exclamation-triangle text-lg"></i>
                            <span class="font-semibold">âš ï¸ Emergency Alert</span>
                        </div>
                        <p class="text-sm text-red-600 dark:text-red-400">
                            Some symptoms require immediate medical attention. If symptoms are severe or worsening, 
                            <strong>call emergency services immediately (911)</strong>.
                        </p>
                    </div>
                ` : ''}
                
                <div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
                    <p class="text-xs text-blue-600 dark:text-blue-400">
                        ðŸ’¡ <strong>Disclaimer:</strong> This information is for general guidance only and does not constitute medical advice. 
                        Always consult with healthcare professionals for proper diagnosis and treatment.
                        ${fromServer ? ' This recommendation was generated by our AI system and logged to your health profile.' : ' This was generated offline - connect to save to your health profile.'}
                    </p>
                </div>
            `;
        }

        // Generate first aid recommendations based on symptoms
        function generateFirstAidRecommendations(symptoms) {
            const recommendationDatabase = {
                'headache': [
                    {
                        action: 'Rest in a Quiet, Dark Room',
                        description: 'Lie down in a comfortable position with minimal light and noise. This helps reduce sensory triggers that can worsen headaches.',
                        icon: 'fas fa-bed'
                    },
                    {
                        action: 'Apply Cold or Warm Compress',
                        description: 'Use a cold compress on your forehead or a warm compress on your neck and shoulders for 15-20 minutes.',
                        icon: 'fas fa-thermometer-half'
                    },
                    {
                        action: 'Stay Hydrated',
                        description: 'Drink plenty of water as dehydration is a common cause of headaches. Avoid alcohol and caffeine.',
                        icon: 'fas fa-tint'
                    }
                ],
                'fever': [
                    {
                        action: 'Monitor Temperature Regularly',
                        description: 'Check temperature every 2-3 hours. Seek medical attention if fever exceeds 103Â°F (39.4Â°C) or persists for more than 3 days.',
                        icon: 'fas fa-thermometer-three-quarters',
                        urgency: 'Monitor Closely'
                    },
                    {
                        action: 'Increase Fluid Intake',
                        description: 'Drink clear fluids like water, herbal teas, or broths to prevent dehydration. Avoid alcohol and caffeinated drinks.',
                        icon: 'fas fa-glass-whiskey'
                    },
                    {
                        action: 'Rest and Light Clothing',
                        description: 'Get plenty of rest and wear lightweight, breathable clothing. Use light blankets if you feel chilly.',
                        icon: 'fas fa-tshirt'
                    }
                ],
                'cough': [
                    {
                        action: 'Stay Hydrated',
                        description: 'Drink warm liquids like herbal tea with honey, warm water, or clear broths to soothe throat irritation.',
                        icon: 'fas fa-mug-hot'
                    },
                    {
                        action: 'Use Honey for Throat Relief',
                        description: 'Take 1-2 teaspoons of honey to coat and soothe the throat. Avoid giving honey to children under 1 year old.',
                        icon: 'fas fa-heart'
                    },
                    {
                        action: 'Elevate Your Head While Sleeping',
                        description: 'Sleep with your head elevated using extra pillows to reduce nighttime coughing and improve breathing.',
                        icon: 'fas fa-bed'
                    }
                ],
                'stomach ache': [
                    {
                        action: 'Try the BRAT Diet',
                        description: 'Eat bland foods like bananas, rice, applesauce, and toast. These are easy to digest and can help settle your stomach.',
                        icon: 'fas fa-apple-alt'
                    },
                    {
                        action: 'Stay Hydrated with Clear Fluids',
                        description: 'Sip clear fluids like water, clear broths, or electrolyte solutions. Avoid dairy, caffeine, and alcohol.',
                        icon: 'fas fa-glass-water'
                    },
                    {
                        action: 'Apply Gentle Heat',
                        description: 'Use a heating pad or warm compress on your abdomen for 15-20 minutes to help relax stomach muscles.',
                        icon: 'fas fa-fire'
                    }
                ],
                'nausea': [
                    {
                        action: 'Try Ginger',
                        description: 'Consume ginger tea, ginger ale, or ginger supplements. Ginger is a natural anti-nausea remedy.',
                        icon: 'fas fa-leaf'
                    },
                    {
                        action: 'Eat Small, Frequent Meals',
                        description: 'Consume small amounts of bland foods throughout the day rather than large meals. Crackers or toast can help.',
                        icon: 'fas fa-cookie-bite'
                    },
                    {
                        action: 'Fresh Air and Deep Breathing',
                        description: 'Get fresh air and practice deep breathing exercises. Avoid strong odors and stuffy environments.',
                        icon: 'fas fa-wind'
                    }
                ],
                'dizziness': [
                    {
                        action: 'Sit or Lie Down Immediately',
                        description: 'Stop what you\'re doing and sit or lie down to prevent falls. Keep your head still and avoid sudden movements.',
                        icon: 'fas fa-chair',
                        urgency: 'Immediate Action'
                    },
                    {
                        action: 'Stay Hydrated',
                        description: 'Drink water slowly. Dehydration can cause or worsen dizziness. Avoid alcohol and caffeine.',
                        icon: 'fas fa-tint'
                    },
                    {
                        action: 'Avoid Sudden Position Changes',
                        description: 'Move slowly when changing positions, especially when standing up from sitting or lying down.',
                        icon: 'fas fa-walking'
                    }
                ],
                'muscle pain': [
                    {
                        action: 'Apply Ice or Heat',
                        description: 'Use ice for acute injuries (first 24-48 hours) or heat for chronic pain and muscle tension. Apply for 15-20 minutes.',
                        icon: 'fas fa-snowflake'
                    },
                    {
                        action: 'Gentle Stretching and Movement',
                        description: 'Perform gentle stretches and light movement to improve circulation and prevent stiffness.',
                        icon: 'fas fa-running'
                    },
                    {
                        action: 'Get Adequate Rest',
                        description: 'Allow the affected muscle to rest and recover. Avoid activities that worsen the pain.',
                        icon: 'fas fa-bed'
                    }
                ],
                'sore throat': [
                    {
                        action: 'Gargle with Salt Water',
                        description: 'Mix 1/2 teaspoon salt in a cup of warm water and gargle several times a day to reduce inflammation.',
                        icon: 'fas fa-tint'
                    },
                    {
                        action: 'Use Throat Lozenges',
                        description: 'Suck on throat lozenges or hard candies to keep your throat moist and provide temporary relief.',
                        icon: 'fas fa-candy-cane'
                    },
                    {
                        action: 'Drink Warm Liquids',
                        description: 'Consume warm tea with honey, warm water with lemon, or clear broths to soothe throat irritation.',
                        icon: 'fas fa-mug-hot'
                    }
                ]
            };

            let allRecommendations = [];
            
            symptoms.forEach(symptom => {
                const symptomKey = symptom.toLowerCase();
                if (recommendationDatabase[symptomKey]) {
                    allRecommendations = allRecommendations.concat(recommendationDatabase[symptomKey]);
                }
            });

            // If no specific recommendations found, provide general advice
            if (allRecommendations.length === 0) {
                allRecommendations = [
                    {
                        action: 'Rest and Monitor Symptoms',
                        description: 'Get plenty of rest and monitor your symptoms closely. Keep track of any changes or worsening conditions.',
                        icon: 'fas fa-eye'
                    },
                    {
                        action: 'Stay Hydrated',
                        description: 'Drink plenty of fluids, especially water, to help your body function properly and aid recovery.',
                        icon: 'fas fa-glass-water'
                    },
                    {
                        action: 'Consult Healthcare Provider',
                        description: 'If symptoms persist, worsen, or you have concerns, contact your healthcare provider for proper evaluation.',
                        icon: 'fas fa-user-md'
                    }
                ];
            }

            // Remove duplicates and limit to 4 recommendations
            const uniqueRecommendations = allRecommendations.filter((rec, index, self) => 
                index === self.findIndex(r => r.action === rec.action)
            );

            return uniqueRecommendations.slice(0, 4);
        }

        // Initialize Location and Facility Search functionality
        function initializeLocationFeatures() {
            // Location features would be implemented here
            console.log('Location features initialized');
        }

        // Initialize Chat functionality
        function initializeChatFeatures() {
            // Chat functionality would be initialized here
            console.log('Chat features initialized');
        }

        // Initialize Goals functionality
        function initializeGoalsFeatures() {
            // Goals functionality would be initialized here
            console.log('Goals features initialized');
        }

        // Initialize Health Tracking functionality
        function initializeHealthTracking() {
            // Health tracking functionality would be initialized here
            console.log('Health tracking features initialized');
            
            // Initialize PDF generation
            initializePdfGeneration();
            
            // Initialize events management
            initializeEventsManagement();
        }

        // PDF Generation Functionality
        function initializePdfGeneration() {
            const generatePdfBtn = document.getElementById('generatePdfBtn');
            if (generatePdfBtn) {
                generatePdfBtn.addEventListener('click', generateMedicalHistoryPDF);
            }
        }

        async function generateMedicalHistoryPDF() {
            const generateBtn = document.getElementById('generatePdfBtn');
            const originalText = generateBtn.innerHTML;
            
            try {
                // Show loading state
                generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating PDF...';
                generateBtn.disabled = true;
                
                // Get user data
                const token = localStorage.getItem('token');
                let userData = {};
                
                if (token) {
                    try {
                        const response = await fetch('http://localhost:5000/api/auth/profile', {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        if (response.ok) {
                            userData = await response.json();
                        }
                    } catch (error) {
                        console.error('Failed to fetch user data:', error);
                    }
                }
                
                // Get health data from localStorage
                const healthData = {
                    goals: JSON.parse(localStorage.getItem('userGoals') || '[]'),
                    mealPlan: JSON.parse(localStorage.getItem('savedMealPlan') || '{}'),
                    surveyData: JSON.parse(localStorage.getItem('healthSurveyData') || '{}'),
                    vitals: JSON.parse(localStorage.getItem('userVitals') || '{}')
                };
                
                // Generate PDF content
                const pdfContent = generatePDFContent(userData, healthData);
                
                // Create and download PDF
                const blob = new Blob([pdfContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `medical-history-${userData.name || 'user'}-${new Date().toISOString().split('T')[0]}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Show success message
                showGoalMessage('Medical history PDF generated successfully!', 'success');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                showGoalMessage('Failed to generate PDF. Please try again.', 'error');
            } finally {
                // Reset button
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }
        }

        function generatePDFContent(userData, healthData) {
            const currentDate = new Date().toLocaleDateString();
            const patientId = userData._id ? userData._id.slice(-6) : 'N/A';
            
            return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical History Report - ${userData.name || 'Patient'}</title>
    <style>
        body { font-family: 'Arial', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; color: #333; }
        .header { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%); color: white; padding: 30px; border-radius: 15px; text-align: center; margin-bottom: 30px; }
        .section { background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-left: 4px solid #4F46E5; }
        .patient-info { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .info-item { padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .goal-item { margin: 10px 0; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9; }
        .vital-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e5e7eb; }
        .footer { text-align: center; color: #6b7280; margin-top: 30px; font-size: 14px; }
        .badge { display: inline-block; padding: 4px 12px; background: #10b981; color: white; border-radius: 20px; font-size: 12px; }
        h1, h2, h3 { color: #1f2937; }
        .watermark { position: fixed; bottom: 20px; right: 20px; opacity: 0.3; font-size: 12px; transform: rotate(-45deg); }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ“‹ Medical History Report</h1>
        <p>Generated on ${currentDate}</p>
        <p>Confidential Health Document</p>
    </div>
    
    <div class="patient-info">
        <div class="info-item">
            <h3>ðŸ‘¤ Patient Information</h3>
            <p><strong>Name:</strong> ${userData.name || 'N/A'}</p>
            <p><strong>Patient ID:</strong> #${patientId}</p>
            <p><strong>Email:</strong> ${userData.email || 'N/A'}</p>
            <p><strong>Report Date:</strong> ${currentDate}</p>
        </div>
        <div class="info-item">
            <h3>ðŸ¥ Account Details</h3>
            <p><strong>Registration:</strong> ${userData.createdAt ? new Date(userData.createdAt).toLocaleDateString() : 'N/A'}</p>
            <p><strong>Status:</strong> <span class="badge">Active</span></p>
            <p><strong>Provider:</strong> HealthGuide Platform</p>
        </div>
    </div>
    
    <div class="section">
        <h2>ðŸŽ¯ Health Goals & Progress</h2>
        ${healthData.goals.length > 0 ? 
            healthData.goals.map(goal => `
                <div class="goal-item">
                    <h4>${goal.title}</h4>
                    <p><strong>Target:</strong> ${goal.target} ${goal.unit || ''}</p>
                    <p><strong>Current:</strong> ${goal.current || 0} ${goal.unit || ''}</p>
                    <p><strong>Progress:</strong> ${goal.progress || 0}%</p>
                    <p><strong>Status:</strong> ${goal.completed ? 'Completed âœ…' : 'In Progress ðŸ”„'}</p>
                </div>
            `).join('') : 
            '<p>No health goals recorded.</p>'
        }
    </div>
    
    <div class="section">
        <h2>ðŸ½ï¸ Nutrition & Meal Planning</h2>
        ${healthData.mealPlan.analysisResults ? `
            <h3>Lab Report Analysis Summary</h3>
            <p><strong>Reports Analyzed:</strong> ${healthData.mealPlan.analysisResults.reportsAnalyzed || 0}</p>
            <p><strong>Health Markers:</strong> ${healthData.mealPlan.analysisResults.healthMarkers?.length || 0}</p>
            <h4>Key Findings:</h4>
            <ul>
                ${healthData.mealPlan.analysisResults.keyFindings?.map(finding => `<li>${finding}</li>`).join('') || '<li>No findings recorded</li>'}
            </ul>
        ` : '<p>No meal plan analysis available.</p>'}
    </div>
    
    <div class="section">
        <h2>ðŸ“Š Health Survey Data</h2>
        ${Object.keys(healthData.surveyData).length > 0 ? `
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                ${Object.entries(healthData.surveyData).map(([key, value]) => `
                    <div class="vital-item">
                        <span><strong>${key.charAt(0).toUpperCase() + key.slice(1)}:</strong></span>
                        <span>${typeof value === 'object' ? JSON.stringify(value) : value}</span>
                    </div>
                `).join('')}
            </div>
        ` : '<p>No survey data available.</p>'}
    </div>
    
    <div class="section">
        <h2>ðŸ’Š Recommendations</h2>
        <div class="goal-item">
            <h4>General Health Recommendations</h4>
            <ul>
                <li>Continue regular health monitoring</li>
                <li>Maintain balanced nutrition as per meal plans</li>
                <li>Stay hydrated with adequate water intake</li>
                <li>Follow prescribed medication schedules</li>
                <li>Schedule regular check-ups with healthcare providers</li>
            </ul>
        </div>
    </div>
    
    <div class="footer">
        <p><strong>Disclaimer:</strong> This report is generated from HealthGuide platform data and is for informational purposes only.</p>
        <p>Always consult with qualified healthcare professionals for medical advice and treatment.</p>
        <p>Report generated by HealthGuide - Your AI-powered health companion</p>
        <p><em>Document ID: ${Date.now()}</em></p>
    </div>
    
    <div class="watermark">HealthGuide Platform</div>
</body>
</html>`;
        }

        // Events Management Functionality
        function initializeEventsManagement() {
            loadUpcomingEvents();
            
            // Add event listener to View All Events button
            const viewAllEventsButtons = document.querySelectorAll('button');
            viewAllEventsButtons.forEach(btn => {
                if (btn.textContent.includes('View All Events')) {
                    btn.addEventListener('click', showAllEvents);
                }
            });
        }

        function loadUpcomingEvents() {
            // Get or create default events
            let events = JSON.parse(localStorage.getItem('healthEvents') || '[]');
            
            if (events.length === 0) {
                // Create default events
                events = [
                    {
                        id: 1,
                        title: 'Health Check-up',
                        date: '2025-08-25',
                        time: '9:00 AM',
                        type: 'appointment',
                        description: 'Annual health screening and consultation',
                        location: 'HealthGuide Clinic'
                    },
                    {
                        id: 2,
                        title: 'Nutrition Workshop',
                        date: '2025-08-27',
                        time: '2:30 PM',
                        type: 'workshop',
                        description: 'Learn about healthy eating habits and meal planning',
                        location: 'Community Center'
                    },
                    {
                        id: 3,
                        title: 'Fitness Assessment',
                        date: '2025-08-30',
                        time: '10:00 AM',
                        type: 'assessment',
                        description: 'Physical fitness evaluation and exercise recommendations',
                        location: 'HealthGuide Fitness Center'
                    },
                    {
                        id: 4,
                        title: 'Mental Health Session',
                        date: '2025-09-02',
                        time: '3:00 PM',
                        type: 'therapy',
                        description: 'Wellness consultation and stress management',
                        location: 'Online Session'
                    }
                ];
                localStorage.setItem('healthEvents', JSON.stringify(events));
            }
            
            updateEventsDisplay(events);
        }

        function updateEventsDisplay(events) {
            const eventsContainer = document.querySelector('.health-card .space-y-4');
            if (!eventsContainer) return;
            
            // Get next 2 upcoming events
            const upcomingEvents = events.slice(0, 2);
            
            eventsContainer.innerHTML = upcomingEvents.map(event => {
                const eventDate = new Date(event.date);
                const month = eventDate.toLocaleDateString('en-US', { month: 'short' }).toUpperCase();
                const day = eventDate.getDate();
                
                const typeColors = {
                    appointment: 'bg-primary-light/10 text-primary-light dark:bg-primary-dark/10 dark:text-primary-dark',
                    workshop: 'bg-secondary-light/10 text-secondary-light dark:bg-secondary-dark/10 dark:text-secondary-dark',
                    assessment: 'bg-purple-500/10 text-purple-500',
                    therapy: 'bg-green-500/10 text-green-500'
                };
                
                return `
                    <div class="flex items-center space-x-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-3 rounded-lg transition-colors" onclick="showEventDetails(${event.id})">
                        <div class="w-12 h-12 ${typeColors[event.type] || typeColors.appointment} rounded-lg flex flex-col items-center justify-center">
                            <span class="text-sm font-medium">${month}</span>
                            <span class="text-lg font-bold">${day}</span>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-medium">${event.title}</h4>
                            <p class="text-sm text-muted-light dark:text-muted-dark">${event.time}</p>
                            ${event.location ? `<p class="text-xs text-muted-light dark:text-muted-dark mt-1">ðŸ“ ${event.location}</p>` : ''}
                        </div>
                        <i class="fas fa-chevron-right text-muted-light dark:text-muted-dark"></i>
                    </div>
                `;
            }).join('');
        }

        function showEventDetails(eventId) {
            const events = JSON.parse(localStorage.getItem('healthEvents') || '[]');
            const event = events.find(e => e.id === eventId);
            
            if (!event) return;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-card-light dark:bg-card-dark rounded-3xl shadow-2xl max-w-md w-full p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold">Event Details</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-lg text-primary-light dark:text-primary-dark">${event.title}</h4>
                            <p class="text-muted-light dark:text-muted-dark">${event.description}</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-background-light dark:bg-background-dark rounded-lg p-3">
                                <p class="text-sm text-muted-light dark:text-muted-dark">Date</p>
                                <p class="font-medium">${new Date(event.date).toLocaleDateString()}</p>
                            </div>
                            <div class="bg-background-light dark:bg-background-dark rounded-lg p-3">
                                <p class="text-sm text-muted-light dark:text-muted-dark">Time</p>
                                <p class="font-medium">${event.time}</p>
                            </div>
                        </div>
                        
                        ${event.location ? `
                            <div class="bg-background-light dark:bg-background-dark rounded-lg p-3">
                                <p class="text-sm text-muted-light dark:text-muted-dark">Location</p>
                                <p class="font-medium">${event.location}</p>
                            </div>
                        ` : ''}
                        
                        <div class="flex space-x-3 mt-6">
                            <button onclick="addToCalendar(${event.id})" class="flex-1 gradient-primary text-white py-3 rounded-xl font-medium hover:shadow-lg transition-all">
                                <i class="fas fa-calendar-plus mr-2"></i>Add to Calendar
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="px-6 py-3 border border-gray-300 dark:border-gray-600 rounded-xl font-medium hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showAllEvents() {
            const events = JSON.parse(localStorage.getItem('healthEvents') || '[]');
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-card-light dark:bg-card-dark rounded-3xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <h3 class="text-2xl font-bold">All Upcoming Events</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            ${events.map(event => `
                                <div class="bg-background-light dark:bg-background-dark rounded-xl p-4 hover:shadow-md transition-all cursor-pointer" onclick="showEventDetails(${event.id})">
                                    <div class="flex items-center justify-between">
                                        <div class="flex-1">
                                            <h4 class="font-semibold text-lg">${event.title}</h4>
                                            <p class="text-sm text-muted-light dark:text-muted-dark">${event.description}</p>
                                            <div class="flex items-center space-x-4 mt-2 text-sm">
                                                <span><i class="fas fa-calendar mr-1"></i>${new Date(event.date).toLocaleDateString()}</span>
                                                <span><i class="fas fa-clock mr-1"></i>${event.time}</span>
                                                ${event.location ? `<span><i class="fas fa-map-marker-alt mr-1"></i>${event.location}</span>` : ''}
                                            </div>
                                        </div>
                                        <i class="fas fa-chevron-right text-muted-light dark:text-muted-dark"></i>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button onclick="addNewEvent()" class="gradient-secondary text-white px-6 py-3 rounded-xl font-medium hover:shadow-lg transition-all">
                                <i class="fas fa-plus mr-2"></i>Add New Event
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function addToCalendar(eventId) {
            const events = JSON.parse(localStorage.getItem('healthEvents') || '[]');
            const event = events.find(e => e.id === eventId);
            
            if (!event) return;
            
            // Create calendar file content
            const startDate = new Date(event.date + ' ' + event.time);
            const endDate = new Date(startDate.getTime() + 60 * 60 * 1000); // 1 hour later
            
            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//HealthGuide//Event//EN
BEGIN:VEVENT
UID:${event.id}@healthguide.com
DTSTAMP:${new Date().toISOString().replace(/[-:]/g, '').split('.')[0]}Z
DTSTART:${startDate.toISOString().replace(/[-:]/g, '').split('.')[0]}Z
DTEND:${endDate.toISOString().replace(/[-:]/g, '').split('.')[0]}Z
SUMMARY:${event.title}
DESCRIPTION:${event.description}
LOCATION:${event.location || ''}
END:VEVENT
END:VCALENDAR`;
            
            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${event.title.replace(/\s+/g, '-')}.ics`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showGoalMessage('Event added to calendar!', 'success');
        }

        function addNewEvent() {
            // This would open a form to add new events
            showGoalMessage('Add new event feature coming soon!', 'info');
        }

        // Make functions globally accessible
        window.showEventDetails = showEventDetails;
        window.addToCalendar = addToCalendar;
        window.addNewEvent = addNewEvent;

        // Hero Section Features
        function initializeHeroFeatures() {
            // Initialize Get Started button
            const getStartedBtn = document.getElementById('getStartedBtn');
            if (getStartedBtn) {
                getStartedBtn.addEventListener('click', handleGetStarted);
            }
            
            // Initialize Watch Demo button
            const watchDemoBtn = document.getElementById('watchDemoBtn');
            if (watchDemoBtn) {
                watchDemoBtn.addEventListener('click', handleWatchDemo);
            }
            
            // Initialize health tracking image rotation
            initializeHealthImageRotation();
            
            // Initialize refresh button
            const refreshHealthBtn = document.getElementById('refreshHealthBtn');
            if (refreshHealthBtn) {
                refreshHealthBtn.addEventListener('click', refreshHealthData);
            }
        }

        function handleGetStarted() {
            const getStartedBtn = document.getElementById('getStartedBtn');
            const originalText = getStartedBtn.innerHTML;
            
            // Show loading state
            getStartedBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Getting Started...';
            getStartedBtn.disabled = true;
            
            // Simulate onboarding process
            setTimeout(() => {
                // Scroll to profile section
                const profileSection = document.getElementById('profile');
                if (profileSection) {
                    profileSection.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
                
                // Show welcome message
                showGoalMessage('Welcome to HealthGuide! Your wellness journey starts here.', 'success');
                
                // Reset button
                getStartedBtn.innerHTML = originalText;
                getStartedBtn.disabled = false;
                
                // Highlight first interactive element
                highlightFirstSteps();
                
            }, 2000);
        }

        function handleWatchDemo() {
            // Create demo modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-card-light dark:bg-card-dark rounded-3xl shadow-2xl max-w-4xl w-full p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-2xl font-bold">HealthGuide Demo</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="aspect-video bg-gradient-to-br from-primary-light/10 to-purple-600/10 rounded-xl flex items-center justify-center mb-4">
                        <div class="text-center">
                            <div class="w-20 h-20 bg-gradient-primary rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-play text-white text-2xl"></i>
                            </div>
                            <h4 class="text-xl font-semibold mb-2">Interactive Demo</h4>
                            <p class="text-muted-light dark:text-muted-dark mb-4">
                                Explore HealthGuide's powerful features including AI-powered meal planning,
                                health tracking, and personalized recommendations.
                            </p>
                            <button onclick="startInteractiveDemo()" class="gradient-primary text-white px-6 py-3 rounded-xl font-medium hover:shadow-lg transition-all">
                                <i class="fas fa-rocket mr-2"></i>Start Interactive Tour
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-4 text-sm">
                        <div class="bg-background-light dark:bg-background-dark rounded-lg p-4">
                            <i class="fas fa-utensils text-primary-light dark:text-primary-dark mb-2"></i>
                            <h5 class="font-medium">AI Meal Planning</h5>
                            <p class="text-muted-light dark:text-muted-dark">Personalized nutrition based on your health data</p>
                        </div>
                        <div class="bg-background-light dark:bg-background-dark rounded-lg p-4">
                            <i class="fas fa-heartbeat text-secondary-light dark:text-secondary-dark mb-2"></i>
                            <h5 class="font-medium">Health Tracking</h5>
                            <p class="text-muted-light dark:text-muted-dark">Real-time monitoring and insights</p>
                        </div>
                        <div class="bg-background-light dark:bg-background-dark rounded-lg p-4">
                            <i class="fas fa-brain text-purple-500 mb-2"></i>
                            <h5 class="font-medium">AI Assistant</h5>
                            <p class="text-muted-light dark:text-muted-dark">24/7 health guidance and support</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function startInteractiveDemo() {
            // Close modal
            const modal = document.querySelector('.fixed.z-\\[60\\]');
            if (modal) modal.remove();
            
            // Start step-by-step guided tour
            startGuidedTour();
        }

        let currentTourStep = 0;
        const tourSteps = [
            {
                target: 'hero',
                title: 'Welcome to HealthGuide',
                description: 'Your comprehensive health and wellness platform. Let\'s explore the key features that will help you achieve your health goals.',
                position: 'bottom'
            },
            {
                target: 'profile',
                title: 'Health Dashboard',
                description: 'Track your wellness journey with real-time health metrics, progress charts, and personalized insights.',
                position: 'bottom'
            },
            {
                target: 'nutriscan',
                title: 'AI-Powered Nutrition',
                description: 'Analyze your meals with advanced AI technology. Get instant nutritional information and personalized dietary recommendations.',
                position: 'top'
            },
            {
                target: 'firstaid',
                title: 'Emergency Health Support',
                description: 'Access life-saving first aid information and emergency protocols when you need them most.',
                position: 'top'
            },
            {
                target: 'goals',
                title: 'Health Goals & Tracking',
                description: 'Set, track, and achieve your health objectives with our intelligent goal management system.',
                position: 'top'
            },
            {
                target: 'healthtracking',
                title: 'Live Health Monitoring',
                description: 'Monitor your health in real-time with dynamic tracking and instant updates.',
                position: 'top'
            }
        ];

        function startGuidedTour() {
            currentTourStep = 0;
            showTourStep();
        }

        function showTourStep() {
            // Remove any existing tour overlay
            const existingOverlay = document.getElementById('tourOverlay');
            if (existingOverlay) existingOverlay.remove();

            if (currentTourStep >= tourSteps.length) {
                // Tour completed
                showTourComplete();
                return;
            }

            const step = tourSteps[currentTourStep];
            const targetElement = document.getElementById(step.target);
            
            if (!targetElement) {
                currentTourStep++;
                showTourStep();
                return;
            }

            // Scroll to target element
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Create tour overlay
            const overlay = document.createElement('div');
            overlay.id = 'tourOverlay';
            overlay.className = 'fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] pointer-events-none';
            
            // Get target element position
            setTimeout(() => {
                const rect = targetElement.getBoundingClientRect();
                
                // Create spotlight effect
                const spotlight = document.createElement('div');
                spotlight.className = 'absolute bg-white/10 rounded-xl pointer-events-none';
                spotlight.style.left = (rect.left - 20) + 'px';
                spotlight.style.top = (rect.top - 20) + 'px';
                spotlight.style.width = (rect.width + 40) + 'px';
                spotlight.style.height = (rect.height + 40) + 'px';
                spotlight.style.boxShadow = '0 0 0 9999px rgba(0, 0, 0, 0.8)';
                spotlight.style.border = '3px solid #4F46E5';
                
                overlay.appendChild(spotlight);

                // Create tour tooltip
                const tooltip = document.createElement('div');
                tooltip.className = 'absolute bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-6 max-w-md pointer-events-auto';
                
                // Position tooltip
                let tooltipLeft, tooltipTop;
                if (step.position === 'bottom') {
                    tooltipLeft = rect.left + (rect.width / 2) - 200;
                    tooltipTop = rect.bottom + 30;
                } else {
                    tooltipLeft = rect.left + (rect.width / 2) - 200;
                    tooltipTop = rect.top - 200;
                }
                
                // Ensure tooltip stays within viewport
                tooltipLeft = Math.max(20, Math.min(tooltipLeft, window.innerWidth - 420));
                tooltipTop = Math.max(20, Math.min(tooltipTop, window.innerHeight - 200));
                
                tooltip.style.left = tooltipLeft + 'px';
                tooltip.style.top = tooltipTop + 'px';
                
                tooltip.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">${step.title}</h3>
                            <div class="text-sm text-gray-500 dark:text-gray-400 mb-2">
                                Step ${currentTourStep + 1} of ${tourSteps.length}
                            </div>
                        </div>
                        <button onclick="endTour()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 ml-4">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <p class="text-gray-700 dark:text-gray-300 mb-6 leading-relaxed">${step.description}</p>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex space-x-2">
                            ${Array.from({length: tourSteps.length}, (_, i) => 
                                `<div class="w-2 h-2 rounded-full ${i === currentTourStep ? 'bg-blue-500' : 'bg-gray-300 dark:bg-gray-600'}"></div>`
                            ).join('')}
                        </div>
                        
                        <div class="flex space-x-3">
                            ${currentTourStep > 0 ? 
                                '<button onclick="previousTourStep()" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 font-medium">Previous</button>' : 
                                ''
                            }
                            <button onclick="nextTourStep()" class="gradient-primary text-white px-6 py-2 rounded-xl font-medium hover:shadow-lg transition-all">
                                ${currentTourStep === tourSteps.length - 1 ? 'Finish Tour' : 'Next'}
                            </button>
                        </div>
                    </div>
                `;
                
                overlay.appendChild(tooltip);
                document.body.appendChild(overlay);
                
                // Add pulsing animation to target element
                targetElement.style.animation = 'pulse 2s infinite';
                
            }, 500);
        }

        function nextTourStep() {
            // Remove animation from current target
            const currentStep = tourSteps[currentTourStep];
            const currentTarget = document.getElementById(currentStep.target);
            if (currentTarget) {
                currentTarget.style.animation = '';
            }
            
            currentTourStep++;
            showTourStep();
        }

        function previousTourStep() {
            // Remove animation from current target
            const currentStep = tourSteps[currentTourStep];
            const currentTarget = document.getElementById(currentStep.target);
            if (currentTarget) {
                currentTarget.style.animation = '';
            }
            
            currentTourStep--;
            showTourStep();
        }

        function endTour() {
            // Remove tour overlay
            const overlay = document.getElementById('tourOverlay');
            if (overlay) overlay.remove();
            
            // Remove animation from any target
            tourSteps.forEach(step => {
                const target = document.getElementById(step.target);
                if (target) target.style.animation = '';
            });
            
            currentTourStep = 0;
            showGoalMessage('Tour ended. Explore HealthGuide at your own pace!', 'info');
        }

        function showTourComplete() {
            // Remove tour overlay
            const overlay = document.getElementById('tourOverlay');
            if (overlay) overlay.remove();
            
            // Remove animation from any target
            tourSteps.forEach(step => {
                const target = document.getElementById(step.target);
                if (target) target.style.animation = '';
            });
            
            // Show completion message
            const completionModal = document.createElement('div');
            completionModal.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm z-[70] flex items-center justify-center p-4';
            completionModal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl max-w-md w-full p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-primary rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Tour Complete!</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-6">
                        You've explored all the key features of HealthGuide. Ready to start your health journey?
                    </p>
                    <div class="flex space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                            Close
                        </button>
                        <button onclick="this.closest('.fixed').remove(); document.querySelector('[onclick*=\\'auth.html\\']').click();" class="flex-1 gradient-primary text-white px-4 py-2 rounded-xl font-medium hover:shadow-lg transition-all">
                            Get Started
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(completionModal);
            
            currentTourStep = 0;
        }

        // Make tour functions globally accessible
        window.nextTourStep = nextTourStep;
        window.previousTourStep = previousTourStep;
        window.endTour = endTour;

        function highlightFirstSteps() {
            // Highlight health goals section
            const goalsSection = document.querySelector('#profile .health-card');
            if (goalsSection) {
                goalsSection.style.border = '2px solid #4F46E5';
                goalsSection.style.boxShadow = '0 0 20px rgba(79, 70, 229, 0.3)';
                
                setTimeout(() => {
                    goalsSection.style.border = 'none';
                    goalsSection.style.boxShadow = '';
                }, 3000);
            }
        }

        // Health Image Rotation System
        function initializeHealthImageRotation() {
            const healthImages = [
                'https://images.unsplash.com/photo-1576091160550-2173dba999ef?auto=format&fit=crop&w=800',
                'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?auto=format&fit=crop&w=800',
                'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?auto=format&fit=crop&w=800',
                'https://images.unsplash.com/photo-1504813184591-01572f98c85f?auto=format&fit=crop&w=800',
                'https://images.unsplash.com/photo-1563013544-824ae1b704d3?auto=format&fit=crop&w=800',
                'https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?auto=format&fit=crop&w=800'
            ];
            
            let currentImageIndex = 0;
            
            // Auto-rotate images every 8 seconds
            setInterval(() => {
                currentImageIndex = (currentImageIndex + 1) % healthImages.length;
                updateHealthImage(healthImages[currentImageIndex]);
                updateHealthScore();
            }, 8000);
            
            // Store images array for manual refresh
            window.healthImages = healthImages;
            window.currentImageIndex = currentImageIndex;
        }

        function updateHealthImage(newImageSrc) {
            const healthImage = document.getElementById('healthTrackingImage');
            if (healthImage) {
                // Fade out
                healthImage.style.opacity = '0.5';
                
                // Change image after fade
                setTimeout(() => {
                    healthImage.src = newImageSrc;
                    healthImage.style.opacity = '1';
                }, 500);
            }
        }

        function updateHealthScore() {
            const healthScore = document.getElementById('healthScore');
            if (healthScore) {
                // Generate random health score between 85-99%
                const newScore = Math.floor(Math.random() * 15) + 85;
                
                // Animate score change
                healthScore.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    healthScore.textContent = newScore + '%';
                    healthScore.style.transform = 'scale(1)';
                }, 300);
            }
        }

        function refreshHealthData() {
            const refreshBtn = document.getElementById('refreshHealthBtn');
            const refreshIcon = refreshBtn.querySelector('i');
            
            // Animate refresh button
            refreshIcon.style.transform = 'rotate(360deg)';
            refreshIcon.style.transition = 'transform 1s ease-in-out';
            
            // Update image
            if (window.healthImages && window.currentImageIndex !== undefined) {
                window.currentImageIndex = (window.currentImageIndex + 1) % window.healthImages.length;
                updateHealthImage(window.healthImages[window.currentImageIndex]);
                updateHealthScore();
            }
            
            // Reset rotation
            setTimeout(() => {
                refreshIcon.style.transform = 'rotate(0deg)';
            }, 1000);
            
            showGoalMessage('Health tracking data refreshed!', 'success');
        }

        // Make functions globally accessible
        window.startInteractiveDemo = startInteractiveDemo;

        // Function to update profile UI with user data
        async function updateProfileUI() {
            const token = localStorage.getItem("token");
            
            // Update navigation based on authentication state
            updateNavigationState(!!token);
            
            if (!token) {
                console.log("No token found, user not logged in");
                return;
            }
            
            try {
                console.log("Fetching user profile...");
                const res = await fetch("http://localhost:5000/api/auth/profile", {
                    method: "GET",
                    headers: { "Authorization": `Bearer ${token}` },
                });
                
                if (res.ok) {
                    const data = await res.json();
                    console.log("Profile data received:", data);
                    
                    if (data && data.name) {
                        const profileNameEl = document.getElementById("profileName");
                        const profileIdEl = document.getElementById("profileId");
                        const userDisplayName = document.getElementById("userDisplayName");
                        const userEmail = document.getElementById("userEmail");
                        
                        if (profileNameEl) {
                            profileNameEl.textContent = data.name;
                            console.log("Updated profile name to:", data.name);
                        }
                        if (profileIdEl) {
                            const shortId = data._id ? data._id.slice(-6) : 'N/A';
                            profileIdEl.textContent = `Patient ID: #${shortId}`;
                            console.log("Updated profile ID to:", shortId);
                        }
                        
                        // Update navigation user info
                        if (userDisplayName) {
                            userDisplayName.textContent = `Welcome, ${data.name}!`;
                        }
                        if (userEmail) {
                            userEmail.textContent = data.email || 'user@example.com';
                        }
                        
                        console.log("Profile updated successfully");
                    } else {
                        console.log("No user data in response");
                    }
                } else {
                    console.error("Failed to fetch profile, status:", res.status);
                    // Token might be invalid, redirect to auth
                    if (res.status === 401) {
                        localStorage.removeItem("token");
                        console.log("Invalid token, redirecting to auth...");
                        updateNavigationState(false);
                        showAuthenticationRequired();
                    }
                }
            } catch (e) {
                console.error("Failed to fetch profile", e);
            }
        }

        // Function to update navigation state based on authentication
        function updateNavigationState(isLoggedIn) {
            const userProfileSection = document.getElementById('userProfileSection');
            const loginBtn = document.getElementById('loginBtn');
            
            if (isLoggedIn) {
                userProfileSection.classList.remove('hidden');
                userProfileSection.classList.add('flex');
                loginBtn.classList.add('hidden');
            } else {
                userProfileSection.classList.add('hidden');
                userProfileSection.classList.remove('flex');
                loginBtn.classList.remove('hidden');
            }
        }

        // Logout functionality
        function handleLogout() {
            // Show confirmation dialog
            if (!confirm('Are you sure you want to logout?')) {
                return;
            }
            
            // Clear authentication data
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            
            // Update navigation state
            updateNavigationState(false);
            
            // Clear user-specific data (optional)
            const userDisplayName = document.getElementById('userDisplayName');
            const userEmail = document.getElementById('userEmail');
            const profileNameEl = document.getElementById("profileName");
            const profileIdEl = document.getElementById("profileId");
            
            if (userDisplayName) userDisplayName.textContent = 'Welcome!';
            if (userEmail) userEmail.textContent = 'user@example.com';
            if (profileNameEl) profileNameEl.textContent = 'Your Name';
            if (profileIdEl) profileIdEl.textContent = 'Patient ID: #000000';
            
            // Clear any cached data
            localStorage.removeItem('userGoals');
            localStorage.removeItem('savedMealPlan');
            localStorage.removeItem('weeklyMealPlan');
            
            // Show success message
            showGoalMessage('Successfully logged out. Redirecting to login...', 'success');
            
            // Redirect to auth page after a brief delay
            setTimeout(() => {
                window.location.href = 'auth.html';
            }, 1500);
        }

        // Goals Management System
        let userGoals = JSON.parse(localStorage.getItem('userGoals')) || [];

        // Load default goals if none exist
        if (userGoals.length === 0) {
            userGoals = [
                {
                    id: 'goal-1',
                    type: 'water',
                    title: 'Daily Water Intake',
                    target: 3,
                    unit: 'L',
                    current: 2.2,
                    frequency: 'daily',
                    priority: 'high',
                    icon: 'fa-tint',
                    color: 'from-blue-400 to-blue-600',
                    progress: 73
                },
                {
                    id: 'goal-2',
                    type: 'exercise',
                    title: 'Weekly Exercise Plan',
                    target: 5,
                    unit: 'days',
                    current: 3,
                    frequency: 'weekly',
                    priority: 'medium',
                    icon: 'fa-running',
                    color: 'from-green-400 to-green-600',
                    progress: 60
                }
            ];
            localStorage.setItem('userGoals', JSON.stringify(userGoals));
        }

        // Goal icons mapping
        const goalIcons = {
            water: 'fa-tint',
            exercise: 'fa-running',
            sleep: 'fa-bed',
            meditation: 'fa-leaf',
            nutrition: 'fa-apple-alt',
            weight: 'fa-weight',
            steps: 'fa-walking',
            custom: 'fa-star'
        };

        // Goal colors mapping
        const goalColors = {
            water: 'from-blue-400 to-blue-600',
            exercise: 'from-green-400 to-green-600',
            sleep: 'from-purple-400 to-purple-600',
            meditation: 'from-indigo-400 to-indigo-600',
            nutrition: 'from-orange-400 to-orange-600',
            weight: 'from-red-400 to-red-600',
            steps: 'from-yellow-400 to-yellow-600',
            custom: 'from-pink-400 to-pink-600'
        };

        // Render goals
        function renderGoals() {
            const container = document.getElementById('goalsContainer');
            if (!container) return;

            let goalsHTML = '';
            userGoals.forEach(goal => {
                const progressPercent = Math.round((goal.current / goal.target) * 100);
                const priorityIcon = goal.priority === 'high' ? 'fa-exclamation' : goal.priority === 'medium' ? 'fa-clock' : 'fa-minus';
                const priorityColor = goal.priority === 'high' ? 'bg-red-400' : goal.priority === 'medium' ? 'bg-orange-400' : 'bg-green-400';

                goalsHTML += `
                    <div class="glass-card goal-card p-6 rounded-2xl hover:bg-primary-light/5 transition-all duration-300 group" data-goal-id="${goal.id}">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-4">
                                <div class="relative">
                                    <div class="w-12 h-12 bg-gradient-to-br ${goal.color} rounded-2xl flex items-center justify-center shadow-lg">
                                        <i class="fas ${goal.icon} text-white text-lg"></i>
                                    </div>
                                    <div class="absolute -top-1 -right-1 w-5 h-5 ${priorityColor} rounded-full flex items-center justify-center">
                                        <i class="fas ${priorityIcon} text-white text-xs"></i>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="font-bold text-lg">${goal.title}</h4>
                                    <p class="text-sm text-muted-light dark:text-muted-dark">Goal: ${goal.target}${goal.unit} â€¢ Current: ${goal.current}${goal.unit}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <button class="gradient-primary text-white px-4 py-2 rounded-full text-sm font-medium hover:scale-105 transition-transform" onclick="updateGoalProgress('${goal.id}')">
                                    <i class="fas fa-plus mr-1"></i> Update
                                </button>
                                <button class="ml-2 text-red-500 hover:text-red-700 p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all" onclick="deleteGoal('${goal.id}')" title="Delete Goal">
                                    <i class="fas fa-trash text-sm"></i>
                                </button>
                                <p class="text-xs text-muted-light dark:text-muted-dark mt-1 capitalize">${goal.frequency}</p>
                            </div>
                        </div>
                        <div class="relative">
                            <div class="w-full h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                <div class="goal-progress-bar bg-gradient-to-r ${goal.color} h-full rounded-full" style="width: ${Math.min(progressPercent, 100)}%"></div>
                            </div>
                            ${progressPercent <= 100 ? `
                                <div class="progress-indicator absolute -top-1 transform -translate-x-1/2" style="left: ${Math.min(progressPercent, 100)}%">
                                    <div class="w-5 h-5 bg-white dark:bg-gray-800 rounded-full border-2 border-blue-500 shadow-lg"></div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="flex justify-between items-center mt-2">
                            <p class="text-sm font-medium ${progressPercent >= 100 ? 'text-green-600 dark:text-green-400' : 'text-blue-600 dark:text-blue-400'}">
                                ${progressPercent >= 100 ? 'ðŸŽ‰ Goal Achieved!' : `${progressPercent}% Complete`}
                            </p>
                            ${progressPercent >= 100 ? '<i class="fas fa-trophy text-yellow-500 text-lg"></i>' : ''}
                        </div>
                    </div>
                `;
            });

            // Add view all goals button
            goalsHTML += `
                <div class="text-center pt-4">
                    <button class="text-primary-light dark:text-primary-dark hover:underline text-sm font-medium flex items-center mx-auto group">
                        View all goals 
                        <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                    </button>
                </div>
            `;

            container.innerHTML = goalsHTML;
        }

        // Add new goal
        function addNewGoal(goalData) {
            const newGoal = {
                id: `goal-${Date.now()}`,
                type: goalData.type,
                title: goalData.title,
                target: parseFloat(goalData.target),
                unit: goalData.unit,
                current: 0,
                frequency: goalData.frequency,
                priority: goalData.priority,
                icon: goalIcons[goalData.type] || 'fa-star',
                color: goalColors[goalData.type] || 'from-gray-400 to-gray-600',
                progress: 0
            };

            userGoals.push(newGoal);
            localStorage.setItem('userGoals', JSON.stringify(userGoals));
            renderGoals();
        }

        // Update goal progress
        function updateGoalProgress(goalId) {
            const goal = userGoals.find(g => g.id === goalId);
            if (!goal) return;

            const newValue = prompt(`Update ${goal.title}\nCurrent: ${goal.current}${goal.unit}\nEnter new value:`, goal.current);
            if (newValue !== null && !isNaN(newValue)) {
                goal.current = parseFloat(newValue);
                goal.progress = Math.round((goal.current / goal.target) * 100);
                localStorage.setItem('userGoals', JSON.stringify(userGoals));
                renderGoals();
                
                // Show success message
                showGoalMessage(`Updated ${goal.title} to ${goal.current}${goal.unit}!`, 'success');
            }
        }

        // Delete goal
        function deleteGoal(goalId) {
            if (confirm('Are you sure you want to delete this goal?')) {
                userGoals = userGoals.filter(g => g.id !== goalId);
                localStorage.setItem('userGoals', JSON.stringify(userGoals));
                renderGoals();
                showGoalMessage('Goal deleted successfully!', 'success');
            }
        }

        // Show goal message
        function showGoalMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-enter fixed top-20 right-4 z-50 px-6 py-4 rounded-xl shadow-lg transform translate-x-full transition-all duration-300 ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            messageDiv.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-times-circle' : 'fa-info-circle'} mr-2"></i>
                    <span class="font-medium">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(messageDiv);
            
            // Animate in
            setTimeout(() => {
                messageDiv.style.transform = 'translateX(0)';
            }, 100);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                if (messageDiv.parentElement) {
                    messageDiv.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (messageDiv.parentElement) {
                            document.body.removeChild(messageDiv);
                        }
                    }, 300);
                }
            }, 4000);
        }

        // Modal functionality
        document.addEventListener('DOMContentLoaded', function() {
            const addGoalBtn = document.getElementById('addGoalBtn');
            const addGoalModal = document.getElementById('addGoalModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const cancelGoalBtn = document.getElementById('cancelGoalBtn');
            const goalForm = document.getElementById('goalForm');
            const goalTypeSelect = document.getElementById('goalType');

            // Auto-populate fields based on goal type
            goalTypeSelect.addEventListener('change', function() {
                const type = this.value;
                const titleInput = document.getElementById('goalTitle');
                const unitInput = document.getElementById('goalUnit');
                const targetInput = document.getElementById('goalTarget');

                const templates = {
                    water: { title: 'Daily Water Intake', unit: 'L', target: 2.5 },
                    exercise: { title: 'Weekly Exercise', unit: 'days', target: 5 },
                    sleep: { title: 'Sleep Schedule', unit: 'hours', target: 8 },
                    meditation: { title: 'Daily Meditation', unit: 'minutes', target: 20 },
                    nutrition: { title: 'Healthy Meals', unit: 'meals', target: 3 },
                    weight: { title: 'Weight Management', unit: 'kg', target: 70 },
                    steps: { title: 'Daily Steps', unit: 'steps', target: 10000 }
                };

                if (templates[type]) {
                    titleInput.value = templates[type].title;
                    unitInput.value = templates[type].unit;
                    targetInput.value = templates[type].target;
                }
            });

            // Open modal
            if (addGoalBtn) {
                addGoalBtn.addEventListener('click', function() {
                    addGoalModal.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';
                });
            }

            // Close modal functions
            function closeModal() {
                addGoalModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                goalForm.reset();
            }

            if (closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
            if (cancelGoalBtn) cancelGoalBtn.addEventListener('click', closeModal);

            // Close modal on outside click
            addGoalModal.addEventListener('click', function(e) {
                if (e.target === addGoalModal) closeModal();
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // ESC to close modal
                if (e.key === 'Escape' && !addGoalModal.classList.contains('hidden')) {
                    closeModal();
                }
                // Ctrl+G to open Add Goal modal
                if (e.ctrlKey && e.key === 'g' && addGoalModal.classList.contains('hidden')) {
                    e.preventDefault();
                    addGoalBtn.click();
                }
            });

            // Handle form submission
            if (goalForm) {
                goalForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const goalData = {
                        type: document.getElementById('goalType').value,
                        title: document.getElementById('goalTitle').value,
                        target: document.getElementById('goalTarget').value,
                        unit: document.getElementById('goalUnit').value,
                        frequency: document.getElementById('goalFrequency').value,
                        priority: document.getElementById('goalPriority').value
                    };

                    // Validate form
                    if (!goalData.type || !goalData.title || !goalData.target || !goalData.unit) {
                        showGoalMessage('Please fill in all required fields!', 'error');
                        return;
                    }

                    addNewGoal(goalData);
                    closeModal();
                    showGoalMessage('Goal added successfully!', 'success');
                });
            }

            // Initial render
            renderGoals();
        });

        // HealthNutri Wellness Survey Functionality
        document.addEventListener('DOMContentLoaded', function() {
            initializeWellnessSurvey();
            initializeHealthCharts();
        });

        function initializeHealthCharts() {
            const chartViewToggle = document.getElementById('chartViewToggle');
            const trendViewToggle = document.getElementById('trendViewToggle');
            const trendChart = document.getElementById('trendChart');

            // Chart view toggle
            if (chartViewToggle) {
                chartViewToggle.addEventListener('click', function() {
                    showChartsView();
                    updateChartActiveState(this, trendViewToggle);
                });
            }

            // Trend view toggle
            if (trendViewToggle) {
                trendViewToggle.addEventListener('click', function() {
                    showTrendView();
                    updateChartActiveState(this, chartViewToggle);
                });
            }

            // Initialize charts with current data
            updateHealthCharts();
            generateTrendChart();
        }

        function updateChartActiveState(activeBtn, inactiveBtn) {
            activeBtn.classList.add('bg-primary-light', 'text-white');
            activeBtn.classList.remove('bg-background-light', 'dark:bg-background-dark', 'border');
            
            inactiveBtn.classList.remove('bg-primary-light', 'text-white');
            inactiveBtn.classList.add('bg-background-light', 'dark:bg-background-dark', 'border', 'border-gray-300', 'dark:border-gray-600');
        }

        function showChartsView() {
            const trendChart = document.getElementById('trendChart');
            if (trendChart) {
                trendChart.classList.add('hidden');
            }
            updateHealthCharts();
        }

        function showTrendView() {
            const trendChart = document.getElementById('trendChart');
            if (trendChart) {
                trendChart.classList.remove('hidden');
                generateTrendChart();
            }
        }

        function updateHealthCharts() {
            const lastSurvey = JSON.parse(localStorage.getItem('lastSurvey') || '{}');
            
            let overallScore = 8.9;
            let nutritionScore = 8.5;
            let activityScore = 7.8;
            let sleepScore = 8.2;

            if (lastSurvey.scores) {
                overallScore = lastSurvey.scores.overallScore;
                nutritionScore = lastSurvey.scores.nutritionScore;
                activityScore = lastSurvey.scores.activityScore;
                sleepScore = lastSurvey.scores.sleepScore;
            }

            // Update radial chart
            updateRadialChart(overallScore);
            
            // Update chart scores
            document.getElementById('chartHealthScore').textContent = overallScore.toFixed(1);
            document.getElementById('chartNutritionScore').textContent = nutritionScore.toFixed(1);
            document.getElementById('chartActivityScore').textContent = activityScore.toFixed(1);
            document.getElementById('chartSleepScore').textContent = sleepScore.toFixed(1);

            // Update chart bars
            document.getElementById('chartNutritionBar').style.width = `${(nutritionScore / 10) * 100}%`;
            document.getElementById('chartActivityBar').style.width = `${(activityScore / 10) * 100}%`;
            document.getElementById('chartSleepBar').style.width = `${(sleepScore / 10) * 100}%`;
        }

        function updateRadialChart(score) {
            const circle = document.getElementById('healthScoreCircle');
            if (circle) {
                const circumference = 2 * Math.PI * 70; // radius = 70
                const offset = circumference - (score / 10) * circumference;
                circle.style.strokeDashoffset = offset;
            }
        }

        function generateTrendChart() {
            const surveyHistory = JSON.parse(localStorage.getItem('surveyHistory') || '[]');
            const svg = document.getElementById('trendSvg');
            
            if (!svg) return;

            // Clear existing content
            svg.innerHTML = `
                <defs>
                    <linearGradient id="trendGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#4F46E5;stop-opacity:0.3" />
                        <stop offset="100%" style="stop-color:#4F46E5;stop-opacity:0" />
                    </linearGradient>
                </defs>
            `;

            // Get last 7 days of data or generate sample data
            let trendData = [];
            if (surveyHistory.length >= 7) {
                trendData = surveyHistory.slice(-7).map(item => ({
                    overall: item.scores?.overallScore || 8.0,
                    nutrition: item.scores?.nutritionScore || 8.0,
                    activity: item.scores?.activityScore || 7.5
                }));
            } else {
                // Generate sample trend data
                trendData = [
                    { overall: 8.2, nutrition: 8.0, activity: 7.8 },
                    { overall: 8.4, nutrition: 8.2, activity: 8.0 },
                    { overall: 8.1, nutrition: 7.9, activity: 7.6 },
                    { overall: 8.6, nutrition: 8.4, activity: 8.2 },
                    { overall: 8.8, nutrition: 8.6, activity: 8.1 },
                    { overall: 8.5, nutrition: 8.3, activity: 7.9 },
                    { overall: 8.9, nutrition: 8.5, activity: 8.0 }
                ];
            }

            const width = svg.clientWidth || 600;
            const height = 180;
            const padding = 40;

            // Draw grid lines
            for (let i = 0; i <= 4; i++) {
                const y = padding + (i * (height - 2 * padding)) / 4;
                const gridLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                gridLine.setAttribute('x1', padding);
                gridLine.setAttribute('y1', y);
                gridLine.setAttribute('x2', width - padding);
                gridLine.setAttribute('y2', y);
                gridLine.setAttribute('stroke', '#e5e7eb');
                gridLine.setAttribute('stroke-width', '1');
                gridLine.setAttribute('opacity', '0.5');
                svg.appendChild(gridLine);
            }

            // Draw trend lines
            const drawTrendLine = (data, color, key) => {
                let pathData = '';
                let areaData = '';
                
                data.forEach((point, index) => {
                    const x = padding + (index * (width - 2 * padding)) / (data.length - 1);
                    const y = height - padding - ((point[key] - 6) / 4) * (height - 2 * padding);
                    
                    if (index === 0) {
                        pathData += `M ${x} ${y}`;
                        areaData += `M ${x} ${height - padding} L ${x} ${y}`;
                    } else {
                        pathData += ` L ${x} ${y}`;
                        areaData += ` L ${x} ${y}`;
                    }
                    
                    // Add data points
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', x);
                    circle.setAttribute('cy', y);
                    circle.setAttribute('r', '4');
                    circle.setAttribute('fill', color);
                    circle.setAttribute('stroke', '#ffffff');
                    circle.setAttribute('stroke-width', '2');
                    svg.appendChild(circle);
                });
                
                areaData += ` L ${width - padding} ${height - padding} Z`;
                
                // Draw area under curve for overall health
                if (key === 'overall') {
                    const area = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    area.setAttribute('d', areaData);
                    area.setAttribute('fill', 'url(#trendGradient)');
                    svg.appendChild(area);
                }
                
                // Draw line
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('stroke', color);
                path.setAttribute('stroke-width', '3');
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke-linecap', 'round');
                path.setAttribute('stroke-linejoin', 'round');
                svg.appendChild(path);
            };

            // Draw trend lines for each metric
            drawTrendLine(trendData, '#3b82f6', 'overall');
            drawTrendLine(trendData, '#10b981', 'nutrition');
            drawTrendLine(trendData, '#8b5cf6', 'activity');
        }

        function initializeWellnessSurvey() {
            const healthRating = document.getElementById('healthRating');
            const healthRatingValue = document.getElementById('healthRatingValue');
            const exerciseButtons = document.querySelectorAll('.exercise-btn');
            const comfortButtons = document.querySelectorAll('.comfort-btn');
            const surveyForm = document.getElementById('healthSurveyForm');

            // Load saved survey data
            loadSurveyData();

            // Health rating slider
            if (healthRating && healthRatingValue) {
                healthRating.addEventListener('input', function() {
                    healthRatingValue.textContent = parseFloat(this.value).toFixed(1);
                    updateHealthScorePreview();
                });
            }

            // Exercise frequency buttons
            exerciseButtons.forEach(button => {
                button.addEventListener('click', function() {
                    exerciseButtons.forEach(btn => {
                        btn.classList.remove('active', 'bg-primary-light', 'text-white');
                        btn.classList.add('border-gray-300', 'dark:border-gray-600');
                    });
                    
                    this.classList.add('active', 'bg-primary-light', 'text-white');
                    this.classList.remove('border-gray-300', 'dark:border-gray-600');
                    
                    document.getElementById('exerciseFrequency').value = this.getAttribute('data-value');
                    updateHealthScorePreview();
                });
            });

            // Comfort level buttons
            const agreeBtn = document.getElementById('agreeBtn');
            const disagreeBtn = document.getElementById('disagreeBtn');

            if (agreeBtn && disagreeBtn) {
                agreeBtn.addEventListener('click', function() {
                    agreeBtn.classList.add('bg-primary-light', 'text-white');
                    agreeBtn.classList.remove('bg-background-light', 'dark:bg-background-dark', 'border');
                    
                    disagreeBtn.classList.remove('bg-primary-light', 'text-white');
                    disagreeBtn.classList.add('bg-background-light', 'dark:bg-background-dark', 'border', 'border-gray-300', 'dark:border-gray-600');
                    
                    document.getElementById('comfortLevel').value = 'agree';
                });

                disagreeBtn.addEventListener('click', function() {
                    disagreeBtn.classList.add('bg-primary-light', 'text-white');
                    disagreeBtn.classList.remove('bg-background-light', 'dark:bg-background-dark', 'border');
                    
                    agreeBtn.classList.remove('bg-primary-light', 'text-white');
                    agreeBtn.classList.add('bg-background-light', 'dark:bg-background-dark', 'border', 'border-gray-300', 'dark:border-gray-600');
                    
                    document.getElementById('comfortLevel').value = 'disagree';
                });
            }

            // Form submission
            if (surveyForm) {
                surveyForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    submitWellnessSurvey();
                });
            }

            // Auto-update scores when inputs change
            const autoUpdateInputs = ['sleepHours', 'healthGoal'];
            autoUpdateInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('change', updateHealthScorePreview);
                }
            });
        }

        function updateHealthScorePreview() {
            const healthRating = parseFloat(document.getElementById('healthRating').value);
            const sleepHours = parseInt(document.getElementById('sleepHours').value);
            const exerciseFreq = document.getElementById('exerciseFrequency').value;
            const comfortLevel = document.getElementById('comfortLevel').value;

            // Calculate scores based on inputs
            let nutritionScore = healthRating * 0.9;
            let activityScore = calculateActivityScore(exerciseFreq);
            let sleepScore = calculateSleepScore(sleepHours);

            // Apply comfort level adjustment
            if (comfortLevel === 'disagree') {
                nutritionScore *= 0.9;
                activityScore *= 0.9;
                sleepScore *= 0.9;
            }

            // Calculate overall score
            const overallScore = (nutritionScore + activityScore + sleepScore) / 3;

            // Update the preview (subtle changes)
            const overallElement = document.getElementById('overallHealthScore');
            if (overallElement && Math.abs(parseFloat(overallElement.textContent) - overallScore) > 0.3) {
                overallElement.style.opacity = '0.7';
                setTimeout(() => {
                    overallElement.style.opacity = '1';
                }, 200);
            }
        }

        function calculateActivityScore(exerciseFreq) {
            const activityScores = {
                '0': 4.0,
                '1-2': 6.5,
                '3-4': 8.0,
                '5+': 9.5
            };
            return activityScores[exerciseFreq] || 7.0;
        }

        function calculateSleepScore(sleepHours) {
            if (sleepHours === 7) return 9.0;
            if (sleepHours === 6 || sleepHours === 9) return 8.0;
            if (sleepHours === 4) return 5.0;
            if (sleepHours === 10) return 6.5;
            return 7.0;
        }

        function submitWellnessSurvey() {
            const formData = {
                healthRating: parseFloat(document.getElementById('healthRating').value),
                sleepHours: parseInt(document.getElementById('sleepHours').value),
                exerciseFrequency: document.getElementById('exerciseFrequency').value,
                comfortLevel: document.getElementById('comfortLevel').value,
                healthGoal: document.getElementById('healthGoal').value,
                timestamp: new Date().toISOString()
            };

            // Calculate new scores
            const nutritionScore = Math.min(10, formData.healthRating * 0.95 + Math.random() * 0.5);
            const activityScore = calculateActivityScore(formData.exerciseFrequency);
            const sleepScore = calculateSleepScore(formData.sleepHours);
            const overallScore = (nutritionScore + activityScore + sleepScore) / 3;

            // Apply comfort level adjustment
            if (formData.comfortLevel === 'disagree') {
                nutritionScore *= 0.9;
                activityScore *= 0.9;
                sleepScore *= 0.9;
            }

            // Update scores with animation
            updateScoreWithAnimation('overallHealthScore', overallScore, 10);
            updateScoreWithAnimation('nutritionScore', nutritionScore, 10);
            updateScoreWithAnimation('activityScore', activityScore, 10);
            updateScoreWithAnimation('sleepScore', sleepScore, 10);

            // Update progress bars
            updateProgressBar('overallHealthBar', (overallScore / 10) * 100);
            updateProgressBar('nutritionBar', (nutritionScore / 10) * 100);
            updateProgressBar('activityBar', (activityScore / 10) * 100);
            updateProgressBar('sleepBar', (sleepScore / 10) * 100);

            // Update status messages
            updateStatusMessages(nutritionScore, activityScore, sleepScore);

            // Update charts
            updateHealthCharts();

            // Save survey data
            saveSurveyData(formData, { nutritionScore, activityScore, sleepScore, overallScore });

            // Show success message
            showSurveyResult();

            // Generate personalized health insight
            generateHealthInsight(formData, { nutritionScore, activityScore, sleepScore, overallScore });
        }

        function updateScoreWithAnimation(elementId, newScore, maxScore) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const currentScore = parseFloat(element.textContent.split('/')[0]);
            const increment = (newScore - currentScore) / 20;
            let currentValue = currentScore;

            const animation = setInterval(() => {
                currentValue += increment;
                if ((increment > 0 && currentValue >= newScore) || (increment < 0 && currentValue <= newScore)) {
                    currentValue = newScore;
                    clearInterval(animation);
                }
                element.textContent = `${currentValue.toFixed(1)}${maxScore ? '/' + maxScore : ''}`;
            }, 50);
        }

        function updateProgressBar(barId, percentage) {
            const bar = document.getElementById(barId);
            if (bar) {
                bar.style.width = Math.min(100, Math.max(0, percentage)) + '%';
            }
        }

        function updateStatusMessages(nutritionScore, activityScore, sleepScore) {
            const nutritionStatus = document.getElementById('nutritionStatus');
            const activityStatus = document.getElementById('activityStatus');
            const sleepStatus = document.getElementById('sleepStatus');

            if (nutritionStatus) {
                nutritionStatus.textContent = nutritionScore >= 8 ? 'Excellent nutritional balance' :
                                           nutritionScore >= 6 ? 'Good balance of nutrients' :
                                           'Consider improving nutrition';
            }

            if (activityStatus) {
                activityStatus.textContent = activityScore >= 8 ? 'Excellent exercise routine' :
                                           activityScore >= 6 ? 'Regular exercise routine' :
                                           'Increase physical activity';
            }

            if (sleepStatus) {
                sleepStatus.textContent = sleepScore >= 8 ? 'Optimal sleep schedule' :
                                        sleepScore >= 6 ? 'Consistent sleep schedule' :
                                        'Improve sleep quality';
            }
        }

        function saveSurveyData(formData, scores) {
            const surveyHistory = JSON.parse(localStorage.getItem('surveyHistory') || '[]');
            surveyHistory.push({
                ...formData,
                scores,
                id: Date.now()
            });
            
            // Keep only last 30 entries
            if (surveyHistory.length > 30) {
                surveyHistory.splice(0, surveyHistory.length - 30);
            }
            
            localStorage.setItem('surveyHistory', JSON.stringify(surveyHistory));
            localStorage.setItem('lastSurvey', JSON.stringify({ ...formData, scores }));
        }

        function loadSurveyData() {
            const lastSurvey = JSON.parse(localStorage.getItem('lastSurvey') || '{}');
            
            if (lastSurvey.healthRating) {
                document.getElementById('healthRating').value = lastSurvey.healthRating;
                document.getElementById('healthRatingValue').textContent = lastSurvey.healthRating.toFixed(1);
            }
            
            if (lastSurvey.sleepHours) {
                document.getElementById('sleepHours').value = lastSurvey.sleepHours;
            }
            
            if (lastSurvey.exerciseFrequency) {
                document.getElementById('exerciseFrequency').value = lastSurvey.exerciseFrequency;
                document.querySelector(`[data-value="${lastSurvey.exerciseFrequency}"]`)?.click();
            }
            
            if (lastSurvey.healthGoal) {
                document.getElementById('healthGoal').value = lastSurvey.healthGoal;
            }

            // Load and display last scores if available
            if (lastSurvey.scores) {
                const { nutritionScore, activityScore, sleepScore, overallScore } = lastSurvey.scores;
                document.getElementById('overallHealthScore').textContent = `${overallScore.toFixed(1)}/10`;
                document.getElementById('nutritionScore').textContent = nutritionScore.toFixed(1);
                document.getElementById('activityScore').textContent = activityScore.toFixed(1);
                document.getElementById('sleepScore').textContent = sleepScore.toFixed(1);
                
                updateProgressBar('overallHealthBar', (overallScore / 10) * 100);
                updateProgressBar('nutritionBar', (nutritionScore / 10) * 100);
                updateProgressBar('activityBar', (activityScore / 10) * 100);
                updateProgressBar('sleepBar', (sleepScore / 10) * 100);
                
                updateStatusMessages(nutritionScore, activityScore, sleepScore);
            }
        }

        function showSurveyResult() {
            const resultDiv = document.getElementById('surveyResult');
            if (resultDiv) {
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('bg-green-50', 'dark:bg-green-900/20', 'border', 'border-green-200', 'dark:border-green-800');
                
                setTimeout(() => {
                    resultDiv.style.opacity = '0';
                    setTimeout(() => {
                        resultDiv.classList.add('hidden');
                        resultDiv.style.opacity = '1';
                    }, 3000);
                }, 5000);
            }
        }

        function generateHealthInsight(formData, scores) {
            const insights = [
                `Based on your ${formData.healthRating}/10 health rating and ${formData.exerciseFrequency} exercise days, consider increasing physical activity for better overall wellness.`,
                `Your sleep pattern of ${formData.sleepHours} hours is contributing to your current health scores. Maintaining consistency is key.`,
                `With a focus on ${formData.healthGoal.replace('-', ' ')}, your current lifestyle choices align well with your goals.`,
                `Your overall health score of ${scores.overallScore.toFixed(1)}/10 reflects good health habits. Keep up the great work!`,
                `Consider improving your weakest area - ${scores.nutritionScore < scores.activityScore && scores.nutritionScore < scores.sleepScore ? 'nutrition' : scores.activityScore < scores.sleepScore ? 'physical activity' : 'sleep quality'} - for better overall wellness.`
            ];

            const randomInsight = insights[Math.floor(Math.random() * insights.length)];
            
            const insightDiv = document.getElementById('healthInsight');
            const insightText = document.getElementById('insightText');
            
            if (insightDiv && insightText) {
                insightText.textContent = randomInsight;
                insightDiv.classList.remove('hidden');
                
                // Auto-hide after 10 seconds
                setTimeout(() => {
                    insightDiv.classList.add('hidden');
                }, 10000);
            }
        }

        // Health Report Generation Functions
        function generateDailyReport() {
            const lastSurvey = JSON.parse(localStorage.getItem('lastSurvey') || '{}');
            
            if (!lastSurvey.scores) {
                alert('Please complete the health survey first to generate a report.');
                return;
            }

            const report = generateHealthReportHTML(lastSurvey, 'daily');
            
            // Create and download report
            const blob = new Blob([report], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `daily-health-report-${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            URL.revokeObjectURL(url);
            
            showGoalMessage('Daily health report downloaded successfully!', 'success');
        }

        function generateWeeklyReport() {
            const surveyHistory = JSON.parse(localStorage.getItem('surveyHistory') || '[]');
            
            if (surveyHistory.length === 0) {
                alert('Please complete some health surveys first to generate a weekly report.');
                return;
            }

            const weeklyData = surveyHistory.slice(-7); // Last 7 entries
            const report = generateWeeklyReportHTML(weeklyData);
            
            // Create and download report
            const blob = new Blob([report], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `weekly-health-summary-${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            URL.revokeObjectURL(url);
            
            showGoalMessage('Weekly health summary downloaded successfully!', 'success');
        }

        function shareHealthData() {
            const lastSurvey = JSON.parse(localStorage.getItem('lastSurvey') || '{}');
            
            if (!lastSurvey.scores) {
                alert('Please complete the health survey first to share data.');
                return;
            }

            const shareData = {
                healthScore: lastSurvey.scores.overallScore.toFixed(1),
                nutritionScore: lastSurvey.scores.nutritionScore.toFixed(1),
                activityScore: lastSurvey.scores.activityScore.toFixed(1),
                sleepScore: lastSurvey.scores.sleepScore.toFixed(1),
                lastUpdated: new Date(lastSurvey.timestamp).toLocaleDateString()
            };

            // Create shareable text
            const shareText = `HealthGuide Wellness Report
Overall Health Score: ${shareData.healthScore}/10
Nutrition: ${shareData.nutritionScore}/10
Physical Activity: ${shareData.activityScore}/10
Sleep Quality: ${shareData.sleepScore}/10
Last Updated: ${shareData.lastUpdated}

Generated by HealthGuide - Your AI-powered health companion`;

            // Try to use Web Share API if available
            if (navigator.share) {
                navigator.share({
                    title: 'My HealthGuide Wellness Report',
                    text: shareText,
                    url: window.location.href
                }).then(() => {
                    showGoalMessage('Health data shared successfully!', 'success');
                }).catch((error) => {
                    console.log('Error sharing:', error);
                    copyToClipboard(shareText);
                });
            } else {
                copyToClipboard(shareText);
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showGoalMessage('Health data copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showGoalMessage('Health data copied to clipboard!', 'success');
            });
        }

        function generateHealthReportHTML(surveyData, type) {
            return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthGuide ${type.charAt(0).toUpperCase() + type.slice(1)} Report</title>
    <style>
        body { font-family: 'Arial', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .header { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%); color: white; padding: 30px; border-radius: 15px; text-align: center; margin-bottom: 30px; }
        .score-card { background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .score { font-size: 2em; font-weight: bold; color: #4F46E5; }
        .progress-bar { width: 100%; height: 10px; background: #e5e7eb; border-radius: 5px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4F46E5, #7C3AED); transition: width 0.3s ease; }
        .footer { text-align: center; color: #6b7280; margin-top: 30px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ¥ HealthGuide ${type.charAt(0).toUpperCase() + type.slice(1)} Health Report</h1>
        <p>Generated on ${new Date().toLocaleDateString()}</p>
    </div>
    
    <div class="score-card">
        <h2>Overall Health Score</h2>
        <div class="score">${surveyData.scores.overallScore.toFixed(1)}/10</div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: ${(surveyData.scores.overallScore/10)*100}%"></div>
        </div>
    </div>
    
    <div class="score-card">
        <h3>Detailed Breakdown</h3>
        <p><strong>Nutritional Balance:</strong> ${surveyData.scores.nutritionScore.toFixed(1)}/10</p>
        <p><strong>Physical Activity:</strong> ${surveyData.scores.activityScore.toFixed(1)}/10</p>
        <p><strong>Sleep Quality:</strong> ${surveyData.scores.sleepScore.toFixed(1)}/10</p>
        <p><strong>Health Goal:</strong> ${surveyData.healthGoal.replace('-', ' ').toUpperCase()}</p>
        <p><strong>Exercise Frequency:</strong> ${surveyData.exerciseFrequency} days per week</p>
        <p><strong>Sleep Duration:</strong> ${surveyData.sleepHours} hours per night</p>
    </div>
    
    <div class="footer">
        <p>Generated by HealthGuide - Your AI-powered health companion</p>
    </div>
</body>
</html>`;
        }

        function generateWeeklyReportHTML(weeklyData) {
            const avgScores = weeklyData.reduce((acc, curr) => {
                if (curr.scores) {
                    acc.overall += curr.scores.overallScore;
                    acc.nutrition += curr.scores.nutritionScore;
                    acc.activity += curr.scores.activityScore;
                    acc.sleep += curr.scores.sleepScore;
                    acc.count++;
                }
                return acc;
            }, { overall: 0, nutrition: 0, activity: 0, sleep: 0, count: 0 });

            if (avgScores.count > 0) {
                avgScores.overall /= avgScores.count;
                avgScores.nutrition /= avgScores.count;
                avgScores.activity /= avgScores.count;
                avgScores.sleep /= avgScores.count;
            }

            return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthGuide Weekly Health Summary</title>
    <style>
        body { font-family: 'Arial', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .header { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%); color: white; padding: 30px; border-radius: 15px; text-align: center; margin-bottom: 30px; }
        .summary-card { background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .trend { display: flex; justify-content: space-between; margin: 10px 0; }
        .improvement { color: #10b981; }
        .decline { color: #ef4444; }
        .stable { color: #6b7280; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ“Š Weekly Health Summary</h1>
        <p>Week ending ${new Date().toLocaleDateString()}</p>
    </div>
    
    <div class="summary-card">
        <h2>Average Weekly Scores</h2>
        <div class="trend">
            <span>Overall Health:</span>
            <span class="improvement"><strong>${avgScores.overall.toFixed(1)}/10</strong></span>
        </div>
        <div class="trend">
            <span>Nutrition:</span>
            <span><strong>${avgScores.nutrition.toFixed(1)}/10</strong></span>
        </div>
        <div class="trend">
            <span>Physical Activity:</span>
            <span><strong>${avgScores.activity.toFixed(1)}/10</strong></span>
        </div>
        <div class="trend">
            <span>Sleep Quality:</span>
            <span><strong>${avgScores.sleep.toFixed(1)}/10</strong></span>
        </div>
    </div>
    
    <div class="summary-card">
        <h3>Weekly Insights</h3>
        <p>ðŸ“ˆ You completed ${weeklyData.length} health assessments this week.</p>
        <p>ðŸŽ¯ Your consistency in tracking health metrics shows great commitment to wellness.</p>
        <p>ðŸ’¡ Continue focusing on your health goals for optimal results.</p>
    </div>
    
    <div style="text-align: center; color: #6b7280; margin-top: 30px;">
        <p>Generated by HealthGuide - Your AI-powered health companion</p>
    </div>
</body>
</html>`;
        }

        // Lab Report and Meal Plan Functionality
        document.addEventListener('DOMContentLoaded', function() {
            initializeMealPlanFeatures();
        });

        let uploadedLabReports = [];
        let analysisResults = null;

        function initializeMealPlanFeatures() {
            const labReportInput = document.getElementById('labReportInput');
            const labReportDropZone = document.getElementById('labReportDropZone');
            const analyzeReportsBtn = document.getElementById('analyzeReportsBtn');
            const clearReportsBtn = document.getElementById('clearReportsBtn');
            const generateMealPlanBtn = document.getElementById('generateMealPlanBtn');
            const refreshMealsBtn = document.getElementById('refreshMealsBtn');
            const saveMealPlanBtn = document.getElementById('saveMealPlanBtn');

            // File upload handling
            if (labReportInput) {
                labReportInput.addEventListener('change', handleFileUpload);
            }

            // Drag and drop handling
            if (labReportDropZone) {
                labReportDropZone.addEventListener('dragover', handleDragOver);
                labReportDropZone.addEventListener('drop', handleFileDrop);
                labReportDropZone.addEventListener('click', () => labReportInput.click());
            }

            // Button event listeners
            if (analyzeReportsBtn) analyzeReportsBtn.addEventListener('click', analyzeLabReports);
            if (clearReportsBtn) clearReportsBtn.addEventListener('click', clearLabReports);
            if (generateMealPlanBtn) generateMealPlanBtn.addEventListener('click', generatePersonalizedMealPlan);
            if (refreshMealsBtn) refreshMealsBtn.addEventListener('click', refreshMealRecommendations);
            if (saveMealPlanBtn) saveMealPlanBtn.addEventListener('click', saveMealPlan);

            // Load existing data
            loadSavedMealPlanData();
        }

        function handleFileUpload(event) {
            const files = event.target.files;
            processFiles(files);
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('border-primary-light', 'dark:border-primary-dark');
        }

        function handleFileDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('border-primary-light', 'dark:border-primary-dark');
            const files = event.dataTransfer.files;
            processFiles(files);
        }

        function processFiles(files) {
            const maxFileSize = 10 * 1024 * 1024; // 10MB
            const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png', 'text/plain'];
            
            Array.from(files).forEach(file => {
                if (file.size > maxFileSize) {
                    showGoalMessage(`File ${file.name} is too large. Maximum size is 10MB.`, 'error');
                    return;
                }

                if (!allowedTypes.includes(file.type)) {
                    showGoalMessage(`File ${file.name} has unsupported format.`, 'error');
                    return;
                }

                uploadedLabReports.push({
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    file: file,
                    uploadDate: new Date().toISOString()
                });
            });

            updateUploadedFilesList();
            updateLabReportStatus();
        }

        function updateUploadedFilesList() {
            const uploadedFilesSection = document.getElementById('uploadedFiles');
            const filesList = document.getElementById('filesList');
            const analyzeBtn = document.getElementById('analyzeReportsBtn');
            const clearBtn = document.getElementById('clearReportsBtn');

            if (uploadedLabReports.length > 0) {
                uploadedFilesSection.classList.remove('hidden');
                
                filesList.innerHTML = uploadedLabReports.map(report => `
                    <div class="flex items-center justify-between p-3 bg-background-light dark:bg-background-dark rounded-lg">
                        <div class="flex items-center space-x-3">
                            <i class="fas ${getFileIcon(report.type)} text-primary-light dark:text-primary-dark"></i>
                            <div>
                                <p class="font-medium text-sm">${report.name}</p>
                                <p class="text-xs text-muted-light dark:text-muted-dark">${formatFileSize(report.size)} â€¢ ${new Date(report.uploadDate).toLocaleDateString()}</p>
                            </div>
                        </div>
                        <button onclick="removeLabReport('${report.id}')" class="text-red-500 hover:text-red-700 transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `).join('');

                analyzeBtn.disabled = false;
                clearBtn.disabled = false;
            } else {
                uploadedFilesSection.classList.add('hidden');
                analyzeBtn.disabled = true;
                clearBtn.disabled = true;
            }
        }

        function getFileIcon(fileType) {
            if (fileType.includes('pdf')) return 'fa-file-pdf';
            if (fileType.includes('image')) return 'fa-file-image';
            if (fileType.includes('text')) return 'fa-file-alt';
            return 'fa-file';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function removeLabReport(reportId) {
            uploadedLabReports = uploadedLabReports.filter(report => report.id !== reportId);
            updateUploadedFilesList();
            updateLabReportStatus();
        }

        function clearLabReports() {
            if (confirm('Are you sure you want to clear all uploaded reports?')) {
                uploadedLabReports = [];
                updateUploadedFilesList();
                updateLabReportStatus();
                hideAnalysisResults();
                showGoalMessage('All lab reports cleared.', 'success');
            }
        }

        function updateLabReportStatus() {
            const statusElement = document.getElementById('labReportStatus');
            if (uploadedLabReports.length === 0) {
                statusElement.innerHTML = '<i class="fas fa-clock mr-1"></i>No reports uploaded';
                statusElement.className = 'text-sm px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300';
            } else {
                statusElement.innerHTML = `<i class="fas fa-check mr-1"></i>${uploadedLabReports.length} report(s) uploaded`;
                statusElement.className = 'text-sm px-3 py-1 rounded-full bg-green-100 dark:bg-green-700 text-green-600 dark:text-green-300';
            }
        }

        async function analyzeLabReports() {
            if (uploadedLabReports.length === 0) {
                showGoalMessage('Please upload lab reports first.', 'error');
                return;
            }

            const progressSection = document.getElementById('analysisProgress');
            const progressBar = document.getElementById('analysisProgressBar');
            
            progressSection.classList.remove('hidden');
            
            // Simulate analysis progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress > 90) progress = 90;
                progressBar.style.width = progress + '%';
            }, 300);

            try {
                // Simulate AI analysis (replace with actual Gemini API call)
                const analysisData = await simulateLabAnalysis();
                
                clearInterval(progressInterval);
                progressBar.style.width = '100%';
                
                setTimeout(() => {
                    progressSection.classList.add('hidden');
                    displayAnalysisResults(analysisData);
                    generatePersonalizedRecommendations(analysisData);
                }, 1000);
                
            } catch (error) {
                clearInterval(progressInterval);
                progressSection.classList.add('hidden');
                showGoalMessage('Analysis failed. Please try again.', 'error');
                console.error('Analysis error:', error);
            }
        }

        async function simulateLabAnalysis() {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Generate realistic analysis results
            const commonMarkers = [
                { name: 'Total Cholesterol', value: Math.floor(Math.random() * 50) + 180, unit: 'mg/dL', normal: '< 200', status: 'normal' },
                { name: 'HDL Cholesterol', value: Math.floor(Math.random() * 20) + 40, unit: 'mg/dL', normal: '> 40', status: 'normal' },
                { name: 'LDL Cholesterol', value: Math.floor(Math.random() * 40) + 100, unit: 'mg/dL', normal: '< 130', status: 'normal' },
                { name: 'Blood Glucose', value: Math.floor(Math.random() * 30) + 80, unit: 'mg/dL', normal: '70-100', status: 'normal' },
                { name: 'Hemoglobin A1C', value: (Math.random() * 1.5 + 5).toFixed(1), unit: '%', normal: '< 5.7', status: 'normal' },
                { name: 'Vitamin D', value: Math.floor(Math.random() * 30) + 25, unit: 'ng/mL', normal: '30-50', status: 'low' },
                { name: 'Iron', value: Math.floor(Math.random() * 50) + 60, unit: 'Î¼g/dL', normal: '60-170', status: 'normal' }
            ];

            return {
                reportsAnalyzed: uploadedLabReports.length,
                healthMarkers: commonMarkers,
                keyFindings: [
                    'Vitamin D levels are below optimal range - consider increasing intake',
                    'Cholesterol levels are within normal limits',
                    'Blood glucose levels indicate good metabolic health',
                    'Iron levels suggest adequate mineral intake'
                ],
                recommendations: {
                    nutrition: [
                        'Increase vitamin D rich foods like fatty fish, egg yolks',
                        'Include iron-rich foods like spinach, lean meats',
                        'Maintain fiber intake for cholesterol management',
                        'Focus on omega-3 fatty acids for heart health'
                    ],
                    lifestyle: [
                        'Get 10-15 minutes of sunlight daily for vitamin D',
                        'Consider vitamin D supplementation',
                        'Regular exercise to maintain cholesterol levels',
                        'Monitor blood sugar with balanced meals'
                    ]
                }
            };
        }

        function displayAnalysisResults(analysisData) {
            const resultsSection = document.getElementById('analysisResults');
            const reportsCount = document.getElementById('reportsCount');
            const markersCount = document.getElementById('markersCount');
            const findingsList = document.getElementById('findingsList');

            reportsCount.textContent = analysisData.reportsAnalyzed;
            markersCount.textContent = analysisData.healthMarkers.length;
            
            findingsList.innerHTML = analysisData.keyFindings
                .map(finding => `<li class="flex items-start"><i class="fas fa-chevron-right mr-2 mt-1 text-xs"></i>${finding}</li>`)
                .join('');

            resultsSection.classList.remove('hidden');
            analysisResults = analysisData;

            // Update health alerts
            updateHealthAlerts(analysisData);
            
            showGoalMessage('Lab report analysis completed successfully!', 'success');
        }

        function updateHealthAlerts(analysisData) {
            const healthAlerts = document.getElementById('healthAlerts');
            const alertsContainer = healthAlerts.querySelector('div');
            
            const lowMarkers = analysisData.healthMarkers.filter(marker => marker.status === 'low' || marker.status === 'high');
            
            if (lowMarkers.length > 0) {
                alertsContainer.innerHTML = lowMarkers.map(marker => 
                    `<p class="text-sm text-orange-800 dark:text-orange-200 mb-2">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        ${marker.name}: ${marker.value} ${marker.unit} (Normal: ${marker.normal})
                    </p>`
                ).join('');
            } else {
                alertsContainer.innerHTML = '<p class="text-sm text-green-800 dark:text-green-200">All markers within normal range! Keep up the good work.</p>';
                alertsContainer.className = 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3';
            }
        }

        function generatePersonalizedRecommendations(analysisData) {
            const personalizedMealPlan = document.getElementById('personalizedMealPlan');
            const personalizedMeals = document.getElementById('personalizedMeals');
            const personalizedGuidance = document.getElementById('personalizedGuidance');
            const personalizedAdvice = document.getElementById('personalizedAdvice');

            // Generate meal recommendations based on analysis
            const mealRecommendations = generateMealsFromAnalysis(analysisData);
            
            personalizedMeals.innerHTML = mealRecommendations.map(meal => `
                <div class="meal-card bg-gradient-to-br from-primary-light/10 to-purple-600/10 rounded-xl overflow-hidden border border-primary-light/20">
                    <img src="${meal.image}" alt="${meal.name}" class="w-full h-32 object-cover">
                    <div class="p-4">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-medium">${meal.name}</h4>
                            <span class="text-xs px-2 py-1 bg-primary-light text-white rounded-full">AI Recommended</span>
                        </div>
                        <div class="text-sm text-muted-light dark:text-muted-dark space-y-1">
                            <p><strong>Calories:</strong> ${meal.calories} | <strong>Protein:</strong> ${meal.protein}g | <strong>Carbs:</strong> ${meal.carbs}g</p>
                            <p class="text-xs mt-2"><strong>Benefits:</strong> ${meal.benefits}</p>
                            <p class="text-xs mt-1 text-primary-light dark:text-primary-dark"><strong>For:</strong> ${meal.reason}</p>
                        </div>
                        <button class="mt-3 text-primary-light dark:text-primary-dark hover:underline text-sm">View Recipe</button>
                    </div>
                </div>
            `).join('');

            // Show personalized lifestyle advice
            personalizedAdvice.innerHTML = analysisData.recommendations.lifestyle.map(advice => 
                `<p class="flex items-start"><i class="fas fa-check text-green-500 mr-2 mt-1 text-xs"></i>${advice}</p>`
            ).join('');

            personalizedMealPlan.classList.remove('hidden');
            personalizedGuidance.classList.remove('hidden');

            // Update nutritional insights based on recommendations
            updateNutritionalInsights(analysisData);
        }

        function generateMealsFromAnalysis(analysisData) {
            const meals = [
                {
                    name: 'Vitamin D Boost Bowl',
                    image: 'https://images.unsplash.com/photo-1511909525232-61113c912358?auto=format&fit=crop&w=800',
                    calories: 420,
                    protein: 25,
                    carbs: 35,
                    benefits: 'Rich in vitamin D, omega-3 fatty acids',
                    reason: 'Low vitamin D levels detected'
                },
                {
                    name: 'Iron-Rich Spinach Salad',
                    image: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=800',
                    calories: 280,
                    protein: 18,
                    carbs: 25,
                    benefits: 'High iron content, fiber, antioxidants',
                    reason: 'Optimizing iron absorption'
                },
                {
                    name: 'Heart-Healthy Salmon',
                    image: 'https://images.unsplash.com/photo-1467003909585-2f8a72700288?auto=format&fit=crop&w=800',
                    calories: 380,
                    protein: 32,
                    carbs: 20,
                    benefits: 'Omega-3 fatty acids, lean protein',
                    reason: 'Cholesterol management support'
                },
                {
                    name: 'Blood Sugar Balance Bowl',
                    image: 'https://images.unsplash.com/photo-1505576399279-565b52d4ac71?auto=format&fit=crop&w=800',
                    calories: 340,
                    protein: 20,
                    carbs: 40,
                    benefits: 'Complex carbs, fiber, protein balance',
                    reason: 'Stable blood glucose support'
                }
            ];

            // Filter based on specific findings
            return meals.slice(0, 2); // Show top 2 recommendations
        }

        function updateNutritionalInsights(analysisData) {
            // Update based on analysis recommendations
            const vitaminDLow = analysisData.healthMarkers.find(m => m.name === 'Vitamin D' && m.status === 'low');
            
            if (vitaminDLow) {
                document.getElementById('dailyCalories').textContent = '2200'; // Slightly higher for nutrient density
                document.getElementById('caloriesProgress').style.width = '70%';
                
                document.getElementById('proteinIntake').textContent = '55g';
                document.getElementById('proteinProgress').style.width = '75%';
            }
        }

        function generatePersonalizedMealPlan() {
            if (!analysisResults) {
                showGoalMessage('Please analyze lab reports first to generate personalized meal plans.', 'error');
                return;
            }

            // Generate a full week meal plan
            const weeklyPlan = generateWeeklyMealPlan(analysisResults);
            displayWeeklyMealPlan(weeklyPlan);
            
            showGoalMessage('Personalized weekly meal plan generated!', 'success');
        }

        function generateWeeklyMealPlan(analysisData) {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const mealTypes = ['Breakfast', 'Lunch', 'Dinner', 'Snack'];
            
            const sampleMeals = {
                'Breakfast': [
                    'Vitamin D Fortified Oatmeal with Berries',
                    'Scrambled Eggs with Spinach',
                    'Greek Yogurt with Nuts',
                    'Avocado Toast with Seeds'
                ],
                'Lunch': [
                    'Quinoa Salad with Iron-rich Greens',
                    'Grilled Salmon with Vegetables',
                    'Lentil Soup with Whole Grain Bread',
                    'Chicken and Vegetable Stir-fry'
                ],
                'Dinner': [
                    'Baked Cod with Sweet Potato',
                    'Turkey Meatballs with Zucchini Noodles',
                    'Vegetarian Bean Chili',
                    'Grilled Chicken with Roasted Vegetables'
                ],
                'Snack': [
                    'Mixed Nuts and Dried Fruit',
                    'Hummus with Vegetable Sticks',
                    'Greek Yogurt with Honey',
                    'Apple with Almond Butter'
                ]
            };

            return days.map(day => ({
                day,
                meals: mealTypes.map(type => ({
                    type,
                    name: sampleMeals[type][Math.floor(Math.random() * sampleMeals[type].length)]
                }))
            }));
        }

        function displayWeeklyMealPlan(weeklyPlan) {
            // Create a modal or new section to display the weekly plan
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-card-light dark:bg-card-dark rounded-3xl shadow-2xl max-w-4xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <h3 class="text-2xl font-bold">Your Personalized Weekly Meal Plan</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <p class="text-muted-light dark:text-muted-dark mt-2">Based on your lab report analysis</p>
                    </div>
                    <div class="p-6">
                        <div class="grid gap-4">
                            ${weeklyPlan.map(dayPlan => `
                                <div class="bg-background-light dark:bg-background-dark rounded-xl p-4">
                                    <h4 class="font-bold text-lg mb-3 text-primary-light dark:text-primary-dark">${dayPlan.day}</h4>
                                    <div class="grid md:grid-cols-4 gap-3">
                                        ${dayPlan.meals.map(meal => `
                                            <div class="bg-card-light dark:bg-card-dark rounded-lg p-3">
                                                <p class="font-medium text-sm text-secondary-light dark:text-secondary-dark">${meal.type}</p>
                                                <p class="text-sm mt-1">${meal.name}</p>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="mt-6 flex justify-center space-x-4">
                            <button onclick="downloadMealPlan()" class="gradient-primary text-white px-6 py-3 rounded-full font-medium">
                                <i class="fas fa-download mr-2"></i>Download PDF
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="border border-gray-300 dark:border-gray-600 px-6 py-3 rounded-full font-medium hover:bg-gray-100 dark:hover:bg-gray-700">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function downloadMealPlan() {
            // Create downloadable meal plan
            const mealPlanData = JSON.parse(localStorage.getItem('weeklyMealPlan') || '[]');
            const html = generateMealPlanHTML(mealPlanData);
            
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `personalized-meal-plan-${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            URL.revokeObjectURL(url);
            
            showGoalMessage('Meal plan downloaded successfully!', 'success');
        }

        function refreshMealRecommendations() {
            // Refresh with new meal suggestions
            const mealCards = document.querySelectorAll('.meal-card');
            mealCards.forEach(card => {
                card.style.opacity = '0.5';
                setTimeout(() => {
                    card.style.opacity = '1';
                }, Math.random() * 1000);
            });
            
            showGoalMessage('Meal recommendations refreshed!', 'success');
        }

        function saveMealPlan() {
            const mealPlanData = {
                analysisResults,
                uploadedReports: uploadedLabReports.map(r => ({
                    name: r.name,
                    uploadDate: r.uploadDate
                })),
                savedDate: new Date().toISOString()
            };
            
            localStorage.setItem('savedMealPlan', JSON.stringify(mealPlanData));
            showGoalMessage('Meal plan saved successfully!', 'success');
        }

        function loadSavedMealPlanData() {
            const savedData = JSON.parse(localStorage.getItem('savedMealPlan') || '{}');
            
            if (savedData.analysisResults) {
                analysisResults = savedData.analysisResults;
                // Restore UI state if needed
            }
        }

        function hideAnalysisResults() {
            document.getElementById('analysisResults').classList.add('hidden');
            document.getElementById('personalizedMealPlan').classList.add('hidden');
            document.getElementById('personalizedGuidance').classList.add('hidden');
            analysisResults = null;
        }

        function generateMealPlanHTML(mealPlanData) {
            return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalized Meal Plan - HealthGuide</title>
    <style>
        body { font-family: 'Arial', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .header { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%); color: white; padding: 30px; border-radius: 15px; text-align: center; margin-bottom: 30px; }
        .day-plan { background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .meal { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; }
        .footer { text-align: center; color: #6b7280; margin-top: 30px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ½ï¸ Your Personalized Meal Plan</h1>
        <p>Generated on ${new Date().toLocaleDateString()}</p>
        <p>Based on lab report analysis</p>
    </div>
    
    <div class="day-plan">
        <h2>Meal Plan Overview</h2>
        <p>This personalized meal plan is generated based on your health markers and nutritional needs identified through AI analysis of your lab reports.</p>
    </div>
    
    <div class="footer">
        <p>Generated by HealthGuide - Your AI-powered health companion</p>
        <p>Always consult with healthcare professionals for medical advice</p>
    </div>
</body>
</html>`;
        }
    </script>
</body>
</html>

